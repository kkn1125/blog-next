---
slug: "/cloudtype01/"
date: 2024-01-10 15:35:08 +0000
modified: 2024-01-10 15:35:08 +0000
title: "[CLOUD] 간편한 클라우드 배포: cloudtype 이용후기와 팁"
author: Kimson
categories: [javascript]
image: /assets/images/post/covers/dalle-til-cover-edit.png
tags: [cloud, deploy, nestjs, til]
description: "이미 `Spring Boot`로 제작했던 프로젝트를 `NestJS`로 새로 제작하면서 어디에 배포할 지 고민을 했습니다. 클라우드 서비스를 검색하면서 알게 된 `cloudtype(이하 클라우드타입)`을 소개하면서 간단한 사용방법과 어떻게 활용하고 있는지를 기록합니다.

해당 포스팅은 광고가 아니며, 순수하게 이용해보고 좋은 평을 남기는 것을 목적으로 하며, 간단한 사용방법과 후기를 작성합니다.

Cloudtype

클라우드타입이 소개하는 내용을 가져오겠습니다."
featured: true
rating: 4.5
profile: false
published: true
---

![cloudtype](https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6a9c0584-cd27-4d1c-9555-fdbb8942ca34%2Fcloudtype_logo_vertical.png&blockId=c38f4d8c-2d4b-4640-a793-d8970dca47ab)

이미 `Spring Boot`로 제작했던 프로젝트를 `NestJS`로 새로 제작하면서 어디에 배포할 지 고민을 하던 중 알게된 서비스를 소개하고 이용방법을 정리하고자 합니다. 검색하면서 알게 된 `cloudtype(이하 클라우드타입)`의 간단한 사용방법과 어떻게 활용하고 있는지를 기록합니다.

해당 포스팅은 광고가 아니며, 순수하게 이용해보고 좋은 평을 남기는 것을 목적으로 하며, 간단한 사용방법과 후기를 작성합니다.

## Cloudtype

클라우드타입이 소개하는 내용을 가져오겠습니다.

> 클라우드 타입은 서버 애플리케이션을 빠르고 편리하게 배포할 수 있는 컨테이너 기반 PaaS 클라우드 서비스 입니다. 따라서 VM 및 VPS 기반의 클라우드와는 다른 특성을 가지고 있습니다. -cloudtype 이용가이드

클라우드타입에서 말하는 장점과 단점은 아래와 같습니다.

### Cloudtype의 특징

- 장점
  1. 코드가 이미지로 빌드되는 과정을 통해 언제나 동일한 환경이 보장
  2. CI/CD 기반 배포 자동화 유리
  3. 무중단 배포, 자동 복구 가능
  4. 특정 배포 시점으로 복구가 쉬워짐
  5. 다른 클라우드 제공자로의 이전 쉬워짐
- 단점
  1. 코드를 이미지로 빌드하는 과정에서 문제를 겪을 수 있음
  2. 고정/퍼블릭 IP 미제공
  3. SSH 직접 연결 미제공
  4. FTP 등을 통한 파일 업로드/다운로드 미지원
  5. 중지 후 재시작 시 데이터 삭제 (영구 디스크 저장 데이터는 제외)
  6. 배포 성공 후에만 터미널 연결 가능

자세한 내용은 <a target="_blank" href="https://help.cloudtype.io/guide/introduce" title="클라우드타입 이용가이드">클라우드타입 이용가이드</a>를 이용해주세요!

## 사용방법

사용방법은 매우 간편합니다. 오히려 `Docs`를 읽지 않아도 UI자체가 잘 짜여있기 때문에 배포 및 관리가 편했습니다.

> 필자는 무료 요금제(hobby)를 사용하고 있습니다. 해당 포스팅은 무료 요금제 기준으로 기록됩니다. 자세한 요금 정보는 <a target="_blank" href="https://cloudtype.io/pricing" title="요금제 링크">요금제 링크</a>를 이용해주세요.

### 프로젝트 생성

회원가입/로그인을 했다고 가정하고, 프로젝트를 하나 생성합니다.

![프로젝트 생성](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/26dd739f-b0cb-4b22-9bdf-d15d37264fdf)

프로젝트를 생성하면 배포할 아이템을 추가해야합니다. 클라우드타입에서 제공하는 다양한 플랫폼을 템플릿으로 선택하거나 깃허브 저장소를 연결하여 배포를 진행할 수 있습니다. 도커나 젠킨스를 사용해본 사용자라면 익숙하게 진행 할 수 있을 것이라 생각합니다.

![깃허브 배포 설정](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/ff85570d-9c2a-4c17-bbb6-3bec95659fe9)

저는 github 저장소를 배포하였기 때문에 "내 GitHub 저장소 배포하기"를 선택했습니다.

### 배포 설정

프로젝트에 배포할 깃허브가 연결되었다면 해당 항목을 클릭하고 "설정"탭으로 이동합니다. 배포 설정에서 다음과 같이 설정합니다.

![배포 설정](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/af89824a-75b1-4cc7-9e6f-eaa9cce9869c)

브랜치는 최신 데이터를 반영하기 위해 main으로 잡고 진행했습니다. 배포 설정에서 무료 요금제는 선택사항이 적습니다. 메모리는 최대 1GB 할당 가능하지만 프로젝트를 샘플로 보여주기 위함이기 때문에 0.5GB를 할당했습니다.

배포하는 서비스는 API이고 제작 시 고려한 node 버전은 v20이므로 v20으로 노드 버전을 맞춰줍니다.

그리고 배포 시 환경변수는 프로젝트 제작 당시 사용했던 .env, .env.\* 에 맞춰서 내용을 이관시켜주면 됩니다.

### 환경변수 설정

예시를 들자면, 아래와 같이 환경변수를 .env.\*에 작성했다고 가정하겠습니다.

```properties filename=".env.production" showLineNumbers
PORT=8000
SECRET_KEY="my_secret"
RESOURCE_PATH="/uploads/profiles"
# ...other key-value
```

```properties filename=".env" showLineNumbers
COMMON_API_PATH="/api"
HOST=0.0.0.0
```

작성된 환경변수를 `key-value`쌍으로 그대로 옮겨주시면 됩니다. 특히나 secretkey 같은 속성은 이후 yaml 부분에서 `secret`으로 수정하거나 프로젝트 환경에서 시크릿변수를 설정해서 교체하여야합니다.

![환경변수 설정 예시](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/36104848-2bd0-4fae-9a57-2ef73c6b4c8c)

시크릿변수 지정은 아래를 진행되는 섹션을 참조해주세요.

#### 시크릿 변수 설정

![프로젝트 환경 설정](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/40d2c73a-4cf5-4f4a-9798-b9f03d955681)

위 이미지에 빨간 동그라미로 표시된 톱니바퀴를 누릅니다. 그러면 공통변수 및 시크릿변수를 설정하는 부분이 나옵니다.

![시크릿 변수 예시](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/c6b33b77-49b2-41b0-aa50-e6e065a30f81)

여기서 시크릿 변수를 지정하고 다시 프로젝트 배포 설정으로 돌아가 변수 값 부분의 열쇠를 클릭하면 등록한 시크릿변수를 활용할 수 있습니다!

![시크릿 변수 활용 예시](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/22485b22-6d58-4da1-96d3-7d28c17412b6)

### 포트 및 설치, 빌드 설정

포트는 서비스가 실행될 때 사용하는 포트를 입력하시면 됩니다. 예를 들어, api 서버가 실행될때 8000포트를 사용한다면 8000을 적으시면 됩니다. 반면에, **포트를 할당하지 않고 실행되는 서비스**라면 **기입하시면 안됩니다**. 해당 내용은 <a href="https://docs.cloudtype.io/guide/references/port#-5">이용가이드</a>를 참고바랍니다.

필자는 `pnpm`을 사용해서 프로젝트를 구성했습니다. 하지만 가이드에 나오는 방법은 `npm ci`명령으로 의존을 설치하고 빌드합니다. `pnpm`을 설치하고 `pnpm`으로 하길 원했지만 원하는데로 되지 않아 `npm`으로 설치, 빌드를 진행했습니다.

> npm 명령으로 실행되는 스크립트는 프로젝트 환경에 따라 다르니 자신의 프로젝트 스크립트에 맞게 수정해주세요.

![설치, 빌드 설정](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/1fe9524d-16db-4584-a936-7bd9f9688aab)

여기서 빌드 시 환경변수를 설정할 수 있습니다. 위에서 설정했던 환경변수와는 성격이 다릅니다. 빌드 시에만 적용되고 서비스 런타임에 반영되는 환경변수가 아닙니다.

여기까지가 배포 과정 전부입니다. 사용해보고 느낀 점은 마무리에서 정리하겠습니다.

## 기타 이슈에 대한 개인 솔루션

클라우드타입을 이용하면서 느낀 이슈는 크게 두 가지였습니다.

1. 무료 요금제의 도메인 적용
2. 연속실행 제한 (매일 3~9시 사이 중지)

### 도메인 적용

자신이 발급받은 도메인이 있다면 해당 도메인을 연결하는 것 또한 간편하게 제공됩니다.

![도메인 연결 예시](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/0b9bf52b-1424-4c7f-9330-96433a9478a1)

배포 항목에 접근해서 "연결"탭으로 이동합니다. 연결할 도메인에 자신의 도메인을 입력하고 "인증하기"를 클릭하면 CNAME 또는 TXT를 도메인 발급 사이트의 설정에서 추가하여 인증하면 끝 입니다.

하지만 무료 요금제는 도메인 연결이 제한되어 있습니다. 랜딩페이지에서 요금 설명에 따르면 커스텀 도메인 연결 지원되지 않는다고 되어있습니다. 이 문제를 해결하기 위해서 솔루션을 공유하고자 합니다.

필자의 경우 오라클 클라우드 프리티어를 사용하고 있습니다.

> 때문에 해당 도메인 솔루션을 시도하려면 클라우드 인스턴스나 물리서버가 필요합니다!

가용 서버가 있다면 해당 서버에서 nginx를 이용해 도메인 tls를 적용하고 `proxy`서버로 이용해서 자신의 도메인을 사용할 수 있습니다 😁

고정, 유동 IP 제공이 안되는 점은 불편하긴 하지만 제공되는 기본 도메인은 고정되는 점을 이용해서 `proxy`를 이용해 자신의 도메인을 연결해보세요.

### 연속실행 제한

클라우드타입에 따르면 아래와 같은 프리티어 정책이 있습니다.

> 연속 실행 제한 : 매일 오전 3 ~ 9시 사이 프리티어로 구동 중인 서비스는 자동으로 중지상태로 변경됩니다. 중지된 서비스를 구동하기 위해서는 대시보드에 접속해서 재시작하는 과정이 필요하며 최초 1회 카드등록 및 본인인증 절차가 필요합니다. (적용 시점 이후 대시보드 접속시 안내 및 진행 예정)

중지상태가 되면 대시보드로 접속해서 시작해주어야합니다. 프로젝트가 중지될 때마다 컴퓨터를 붙잡고 있을 상황이 아니기 때문에 proxy 서버에서 배치를 돌리기로 했습니다.

클라우드타입에서 제공하는 CLI를 설치하고 배치 프로그램을 만들어서 cron을 실행합니다.

해당 배치는 다음과 같은 동작을 합니다.

1. 서버 타임존이 외국이기 때문에 한국 시간 차이를 고려해서 cron을 설정합니다.
2. 3~9시 사이 프로젝트가 중지 상태인지 0분, 30분 기준으로 확인합니다.
3. 정지 상태라면 다시 배포를 진행하도록 명령합니다.

현재 3일째 디버깅을 통해 테스트 중입니다만, 해외 시간차 계산이 잘못되어 아직까지 테스트 중 입니다.

## 마무리

클라우드타입이라는 클라우드 서비스를 이용하고 사용방법을 작성해봤습니다. 이제 사용해본 후기를 작성할텐데요. 개인적인 관점에서 작성되었음을 알립니다.

먼저, UI부분에서는 심플하고 보기 편하다는 느낌이 들었습니다. 무엇이 필요한지 생각해보면 화면에서 대부분 원하는 위치, 여기에 이런 옵션이 있겠지 하는 부분이 잘 해소되었다고 생각합니다.

그런데 공통변수와 시크릿 변수를 지정하는 버튼의 위치가 사용자 입장에서 과연 괜찮을까 하는 생각이 들었습니다.

오히려 스페이스에서 리스트업되는 프로젝트에 프로젝트별로 공통/시크릿 변수를 설정하는 톱니바퀴가 있으면 찾기도 쉽고 프로젝트별로 공통/시크릿 변수를 관리하기 편하지 않을까 생각됩니다.

그 외 다른 부분은 굉장히 만족합니다. 개인적으로 유사하다고 생각되는 헤로쿠와 비교하자면 매우 좋다고 생각합니다.

필자가 헤로쿠를 사용했던 2년전의 경우 연말즈음 되면 닫혀버리는 단점이 있었습니다. 클라우드타입에서는 3 ~ 9시 사이 중지되는 이슈가 있지만, 사용자가 신경만 쓴다면 프로젝트를 언제든지 재시작할 수 있으니 무료 요금제 클라우드 서비스 중에서 큰 메리트가 아닌가 생각됩니다.

클라우드 서비스를 이용하면서 결제까지 고민 중인 서비스는 클라우드타입이 처음이고 매우 만족하고 있어서 포스팅합니다.

이용해보고 싶은 분들에게 도움이 되었으면 합니다 😁

> 짧은 댓글이라도 포스팅 하는데 힘이 됩니다 🌟
