---
slug: "/node-both-side-project-combine-build/"
date: 2023-07-10 13:49:51 +0000
modified: 2023-07-10 13:49:51 +0000
title: "[Node] Node 환경에서 프론트와 백엔드 같이 빌드하기"
author: Kimson
categories: [node]
image: /assets/images/post/covers/TIL-node.png
tags: [node, fastify, react, combine, build, til]
description: ""
featured: true
rating: 4.5
profile: false
published: true
---

# 프로젝트 결합 빌드

오랜만에 포스팅 합니다. 솔직히 방문자 수가 줄어들면 어쩌나 하는 생각도 들더라구요 😊

이번에는 조금 실험적인 주제를 다루려고 합니다. 그만큼 포스팅에서 이야기 할 거리도 좀 적은게 흠이네요. 아직 시도해 본 적이 없어서 실험적이라는 말을 썼는데요. 자바 진영에서 react를 같이 빌드했던 기억이 있습니다. 현재는 Node를 사용하고, 사용하면서 백단과 프론트를 같이 빌드해서 실행해본 경우는 없습니다. 현재 처한 상황에서 이런게 필요하겠다 싶어서 테스트 후 기록해봅니다.

우선 프로젝트 환경에 대해 설명하자면 다음과 같습니다.

1. Node - 18.11.0
2. Fastify
3. React(SPA)

API 서버를 만드는데 Fastify 프레임워크를 사용하고 있습니다. 이전에는 Express.js를 사용했지만 스타트업 특성상 고정되거나 항상 사용하던 기술이 아닌 새로운 기술을 사용할 수 있다는 장점이 있기도 하고, Express가 은근히 오래 되기도 했고, Fastify가 성능상 Express보다 좋다는 말에 현혹되어 써보기로 마음먹었습니다.

자바에서도 마찬가지인 사항이지만 빌드하기 전까지 개발 단계에서는 프론트와 백엔드는 서로 다른 포트를 사용해서 개발합니다. 노드에서도 마찬가지고요.

다만 다른 점이라고는 자바에서는 메이븐 설정에서 빌드 시 리액트 빌드 명령을 주면 빌드 후 알아서 경로가 잡히고, 노드에서는 동일한 과정이 있지만 마지막에 빌드된 경로로 매칭시키고 리소스 경로를 연결해주는 작업이 좀 필요합니다.

> 혹시나 잘못된 내용이 있다면 지적 부탁드리겠습니다!

## 결합 절차

먼저 프론트와 백엔드가 이미 생성되어 있다고 가정하겠습니다. 기존에 저는 이 실험을 하기 전까지 백엔드와 프론트를 개별로 포트 할당하여 배포 실행했습니다.

하지만 결합해서 빌드해버리면 단일 포트로 두개를 결합 배포 및 실행 가능합니다.

혹시 독자 중 fastify가 아닌 express나 다른 프레임워크를 사용한다 해도 동일한 내용이니 참고 바랍니다.

### 프론트 메인 경로 매핑

먼저 리액트(또는 Vue)가 빌드되는 디렉토리를 적당한 위치에 옮깁니다. 그대로 두셔도 됩니다. 파일 트리를 보자면 아래와 같을 겁니다.

```md
- api root/
  - admin_page/
    - dist/ <--- 리액트 빌드된 디렉토리
      - assets/
        - gfw450ghj4o5tg45g.js
        - gfw450ghj4o5tg45g.css
      - index.html
    - src/
    - main.js
  - index.js <--- 백엔드 프로젝트 메인
  - package.json
```

백단에서 빌드된 리액트 프로젝트를 실행 할 경로를 매핑합니다. 저는 `"/"`로 지정했습니다. api부분은 `"/v1/api/*"`로 지정했기 때문에 필자는 메인 패스를 사용해도 상관없었습니다.

매핑 하셨다면 응답 헤더에 `"Content-Type"`을 `"text/html;charset=utf8"`로 변경하고, 응답 데이터는 빌드된 리액트 `index.html` 파일을 읽어 내보냅니다.

그러면 1차 작업은 끝이 납니다.

### 프론트 리소스 경로 매핑

1차까지만 하고 실행하면 화면이 뜨지 않고 리소스를 찾지 못했다는 에러가 발생할 수 있습니다.

![1차 후 실행 시 에러](https://github.com/kkn1125/kkn1125.github.io/assets/113876485/f72ff33e-72e5-4569-8084-f8c410640059)

이렇게 공백이 뜨는 이유는 프론트 빌드 시 필요한 리소스 경로를 찾지 못했다는 이유 때문입니다.

너무나도 당연한 결과입니다. API서버에서 매핑한 경로이기 때문에 기본적으로 API 서버 기준에서 리소스를 찾아야 합니다. API서버에 리소스를 가져와 응답해주는 매핑 작업을 하지 않았으니 만들어주어야겠지요.

리소스를 프론트 제작 시 리소스 경로를 하나로 묶어주면 좋습니다. 왜냐하면 API서버에서 매핑할 때 참조하는 경로의 상위 디렉토리를 기준으로 모든 request를 처리하면 편하기 때문이지요.

필자는 이미지를 별도로 관리했기 때문에 매핑을 두 가지를 만들어야 하는 번거로움이 있었습니다.

![리소스 매핑](https://github.com/kkn1125/kkn1125.github.io/assets/113876485/197a2d9e-5a54-4240-9489-70eaf0578a2a)

이제 리소스 매핑 후 API서버 빌드 또는 개발모드로 실행해서 확인해보면 모든 리소스가 정상 로드되고 빌드된 리액트가 잘 작동하는 것을 볼 수 있습니다.

![정상 매핑된 프론트](https://github.com/kkn1125/kkn1125.github.io/assets/113876485/a211adf7-cefa-4c69-90ba-9e8fff88014a)

## 마무리

이번 테스트를 하면서 발생하는 이슈는 두가지 정도 인 것 같습니다. 만일 많은 데이터를 처리해야하는 API 서버라면 굳이 합치기보다는 따로 떼어 놓는 편이 좋을 수도 있다고 생각이 듭니다.

하지만 처리량이 많지 않고 포트가 부족하다면 한 번 쯤은 고려해볼만한 솔루션이 아닐까 생각합니다.

현재 필자가 겪은 이슈는 아래와 같습니다.

1. 프론트 빌드 시 매핑경로가 `"/"`이지만 `react-router-dom`을 사용한다면 빌드 시 prefix path를 설정해서 아예 고유한 패스로 매핑하는게 좋지 않을까 하는 생각이 듭니다.
2. 리소스 또한 마찬가지 이야기지만 하나의 상위 디렉토리로 묶어서 매핑하는게 오히려 관리 목적에서는 편하지 않을까 생각합니다. 개별로 커스터마이징이 필요하다면 개별로 찢어서 작성하는 편이 유리할 수도 있겠구요.

이 방법을 시도한 이유는 현재 프로젝트 진행 중에 과연 관리자 페이지를 생성하고 별도의 도메인이 추가로 필요한가에 대한 비용적인 측면과 실험적인 궁금증으로 인해 시도하게 됐습니다.

꽤 흥미있는 이야기였으면 좋겠습니다 😊
