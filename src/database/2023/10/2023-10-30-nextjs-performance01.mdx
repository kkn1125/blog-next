---
slug: "/nextjs-performance01/"
date: 2023-10-30 16:28:13 +0000
modified: 2023-10-30 16:28:13 +0000
title: "[NEXT.js] Next.js ë¹Œë“œ ì†ë„ ê°œì„  - ì›¹ ì‚¬ì´íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ë§Œë“œëŠ” ë°©ë²•"
author: Kimson
categories: [next]
image: /assets/images/post/covers/nextjs-black-logo.svg
tags: [next, preformance, upgrade, til]
description: "`Next.js(ì´í•˜ ë„¥ìŠ¤íŠ¸)`ëŠ” êµ¬ì¸ê³µê³ ë¥¼ ë³´ë©´ ê½¤ ë§ì€ ë¹„ì¤‘ì„ ì°¨ì§€í•˜ëŠ” í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. `ë„¥ìŠ¤íŠ¸`ëŠ” 13ë²„ì „ ì „, í›„ë¡œ í¬ê²Œ ë‚˜ë‰˜ê²Œ ë˜ëŠ”ë° \"ë””ë ‰í† ë¦¬\"ë°©ì‹ê³¼ \"ì•±\"ë°©ì‹ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. í˜„ì¬ ë¸”ë¡œê·¸ëŠ” \"ë””ë ‰í† ë¦¬\"ë°©ì‹ì„ ì„ íƒí•´ì„œ ë°°í¬ëœ ì˜ˆë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ì„œ \"ë°©ì‹\"ê³¼ ìƒê´€ì—†ì´ ë¸”ë¡œê·¸ë¥¼ ì§€ì†ì ìœ¼ë¡œ ìš´ì˜í•˜ë‹¤ë³´ë©´ í¬ìŠ¤íŠ¸ê°€ ëŠ˜ì–´ë‚˜ê³  ê°œë°œ í™˜ê²½ì—ì„œ ì´ˆê¸° ë¡œë“œ, í˜ì´ì§€ ë³€ê²½, ë¹Œë“œ ë°°í¬ ì‹œê°„ì´ ì ì  ê¸¸ì–´ì§€ëŠ” ê²ƒì„ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ë¹Œë“œí•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë„ í˜ì´ì§€ë¥¼ ë¡œë”©í•˜ëŠ” ì†ë„ë¥¼ ê°œì„ í•˜ëŠ” ë°©ë²•ì„ ê¸°ë¡í•´ë³´ê³ ì í•©ë‹ˆë‹¤.

Next.js ë¹Œë“œ ì†ë„ì˜ ì¤‘ìš”ì„±

ë¹Œë“œ ì†ë„ê°€ ëŠë ¤ì§€ë©´ ëŠë ¤ì§ˆìˆ˜ë¡ ê°œë°œì— ì•ˆì¢‹ì€ ì˜í–¥ì„ ì£¼ë©´ì„œ ë•Œë¡œëŠ” ë„ˆë¬´ ëŠë ¤ì„œ ê°œë°œí•˜ëŠ” ê²ƒì¡°ì°¨ êº¼ë ¤ì§ˆ ë•Œê°€ ìˆìŠµë‹ˆë‹¤."
featured: true
rating: 4.5
profile: false
published: true
---

`Next.js(ì´í•˜ ë„¥ìŠ¤íŠ¸)`ëŠ” êµ¬ì¸ê³µê³ ë¥¼ ë³´ë©´ ê½¤ ë§ì€ ë¹„ì¤‘ì„ ì°¨ì§€í•˜ëŠ” í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. `ë„¥ìŠ¤íŠ¸`ëŠ” 13ë²„ì „ ì „, í›„ë¡œ í¬ê²Œ ë‚˜ë‰˜ê²Œ ë˜ëŠ”ë° "ë””ë ‰í† ë¦¬"ë°©ì‹ê³¼ "ì•±"ë°©ì‹ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. í˜„ì¬ ë¸”ë¡œê·¸ëŠ” "ë””ë ‰í† ë¦¬"ë°©ì‹ì„ ì„ íƒí•´ì„œ ë°°í¬ëœ ì˜ˆë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ì„œ "ë°©ì‹"ê³¼ ìƒê´€ì—†ì´ ë¸”ë¡œê·¸ë¥¼ ì§€ì†ì ìœ¼ë¡œ ìš´ì˜í•˜ë‹¤ë³´ë©´ í¬ìŠ¤íŠ¸ê°€ ëŠ˜ì–´ë‚˜ê³  ê°œë°œ í™˜ê²½ì—ì„œ ì´ˆê¸° ë¡œë“œ, í˜ì´ì§€ ë³€ê²½, ë¹Œë“œ ë°°í¬ ì‹œê°„ì´ ì ì  ê¸¸ì–´ì§€ëŠ” ê²ƒì„ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë¬¸ì— ë¹ ë¥´ê²Œ ë¹Œë“œí•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë„ í˜ì´ì§€ë¥¼ ë¡œë”©í•˜ëŠ” ì†ë„ë¥¼ ê°œì„ í•˜ëŠ” ë°©ë²•ì„ ê¸°ë¡í•´ë³´ê³ ì í•©ë‹ˆë‹¤.

# Next.js ë¹Œë“œ ì†ë„ì˜ ì¤‘ìš”ì„±

ë¹Œë“œ ì†ë„ê°€ ëŠë ¤ì§€ë©´ ëŠë ¤ì§ˆìˆ˜ë¡ ê°œë°œì— ì•ˆì¢‹ì€ ì˜í–¥ì„ ì£¼ë©´ì„œ ë•Œë¡œëŠ” ë„ˆë¬´ ëŠë ¤ì„œ ê°œë°œí•˜ëŠ” ê²ƒì¡°ì°¨ êº¼ë ¤ì§ˆ ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì ì  ëŠë ¤ì§€ëŠ” ì†ë„ ë•Œë¬¸ì— ë¹Œë“œ ì‹œì¼œë†“ê³  ì‹œê°„ì„ í—ˆë¹„í•  ìˆ˜ ì—†ëŠ” ë…¸ë¦‡ì´ì§€ìš”.

ë¹Œë“œê°€ ëŠë ¤ì§€ëŠ” ì´ìœ ëŠ” ë‹¨ìˆœíˆ í¬ìŠ¤íŠ¸ê°€ ë§ì•„ì„œì˜ ì´ìœ ì¼ ìˆ˜ ìˆê³ , ìµœì í™” ë˜ì§€ ì•Šì€ `getStaticProps`ìœ¼ë¡œ ë‹¤ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ í˜ì´ì§€ë³„ ë¹Œë“œ ì†ë„ê°€ ì €í•˜ë˜ëŠ” ê²ƒì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” í˜ì´ì§€ë³„ `getStaticProps`ë¥¼ ì œê±°í•˜ë©´ì„œ ë¹Œë“œ ì‹œ ê¸°ì¡´ë³´ë‹¤ ë¹ ë¥¸ ì†ë„ë¡œ ì™„ë£Œí•  ìˆ˜ ìˆê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì— ëŒ€í•´ ê¸°ë¡í•˜ë ¤í•©ë‹ˆë‹¤.

## ë¹Œë“œ ì†ë„ ê°œì„ ì„ ìœ„í•œ ì „ëµ

í•„ìì˜ ê²½ìš° í˜ì´ì§€ë³„ ë°ì´í„° ë¡œë“œ ìš©ëŸ‰ì´ ê¸°ì¤€ì¹˜ì˜ 128KBë¥¼ ì´ˆê³¼í•´ì„œ í…ŒìŠ¤íŠ¸í™˜ê²½ê³¼ ë¹Œë“œí™˜ê²½ ëª¨ë‘ ëŠë¦¬ê²Œ ë™ì‘í•´ì„œ ë§ì€ ë‹µë‹µí•¨ì„ ëŠê¼ˆìŠµë‹ˆë‹¤. ë¹Œë“œ ì†ë„ë¥¼ ê°œì„ í•˜ëŠ”ë° ì‚¬ìš©í•œ ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. í˜ì´ì§€ ë³„ ë°ì´í„° ë¡œë“œ ì–‘ ì¤„ì´ê¸°
2. ë¹Œë“œ ì‹œ fetch ë°ì´í„° ë˜í•œ ë¹Œë“œë˜ë¯€ë¡œ, í•„ìš”í•œ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì¶”ì¶œí•˜ê¸°
3. ë°ì´í„° ì¶”ì¶œ ëª¨ë“œ ê°œë°œ, í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ë¶„ë¦¬í•˜ê¸°

ìœ„ 3ë²ˆì„ ì œì™¸í•œ 1, 2ë²ˆì´ ì£¼ìš”ì ì…ë‹ˆë‹¤. ìœ„ ì „ëµì„ ì ìš©í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ëŠ” `getStaticProps`ë¥¼ ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.

`getStaticProps`ì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë°ì´í„°ëŠ” ë„¥ìŠ¤íŠ¸ê°€ ë¹Œë“œí•  ë•Œ ë°ì´í„°ë¥¼ ê°™ì´ ë¹Œë“œí•©ë‹ˆë‹¤. ë•Œë¬¸ì— `[slug].ts`ë¼ëŠ” í˜ì´ì§€ê°€ `getStaticProps`ë¥¼ í†µí•´ ë§ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë©´ì„œ 100ê°œ ë˜ëŠ” ê·¸ë³´ë‹¤ ë§ì€ ì–‘ì˜ í¬ìŠ¤íŠ¸ê°€ ë¹Œë“œëœë‹¤ë©´ í”„ë¡œì íŠ¸ ìš©ëŸ‰ ë° ë¹Œë“œ ì‹œê°„ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ëŠ˜ì–´ë‚©ë‹ˆë‹¤.

### getStaticPropsê°€ í•„ìš”ê°€ ì—†ëŠ” ê²ƒì¸ê°€?

`getStaticProps`ê°€ ë¬´ì“¸ëª¨ë¼ëŠ” ë§ì€ ì•„ë‹™ë‹ˆë‹¤. ë‹¨ìˆœíˆ í•„ìì˜ ê²½ìš° ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ë¡œë“œí•˜ê³  ë¹Œë“œ ì†ë„ì™€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•œ 1ì°¨ì›ì ì¸ í•´ê²°ë°©ë²•ì…ë‹ˆë‹¤. ìœ ìš©í•œ ê¸°ëŠ¥ì€ ê·¸ì— ë§ê²Œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

í˜„ì¬ ë¸”ë¡œê·¸ì˜ ìƒí™©ê³¼ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ê³ ë ¤í–ˆì„ ë•Œ ë°ì´í„°ë¥¼ í•œ ë²ˆ ë¡œë“œí•˜ë©´ì„œ ëª¨ë“  í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ê³µìœ í•˜ê³  í…ŒìŠ¤íŠ¸ ì†ë„ë¥¼ ê°œì„ í•˜ëŠ”ë°ëŠ” ì´ë§Œí•œ ë°©ë²•ì´ ì—†ì—ˆìŠµë‹ˆë‹¤.

## getStaticPropsê°€ ì—†ë‹¤ë©´ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¤ëŠ”ê°€?

`getStaticProps`ëŠ” í•´ë‹¹ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë¥¼ `props`ë¡œ ì „ë‹¬ ë°›ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ `getStaticProps`ë¥¼ ì œê±°í•˜ê³  ë‚˜ë©´ ë°ì´í„°ë¥¼ ê³µìœ í•˜ëŠ” ë°©ë²•ì€ ë§ê² ì§€ë§Œ í•„ìëŠ” `context`ë¥¼ ìƒì„±í•´ì„œ ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì œì–´í•˜ëŠ” ë°©ë²•ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

```typescript showLineNumbers filename="src/pages/blog/[slug].ts" highlight={9-12,16-19}
// ... others
const Index = () => {};

export const getStaticProps = async ({
  params,
}: {
  params: { slug: string };
}) => {
  const current = await findArticleBySlug(params.slug);
  const { prev, current, next } = await findArticleFromSlugAndBothSideArticles(
    params.slug
  );

  return {
    props: {
      params,
      prev,
      current,
      next,
    },
  };
};
```

ê¸°ì¡´ì— ì‚¬ìš©í•˜ëŠ” ì½”ë“œëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. `getStaticProps`ì—ì„œ ë‚´ë ¤ì£¼ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì œê±°í•©ë‹ˆë‹¤. `[...].ts`íŒŒì¼ì˜ ê²½ìš° `getStaticPaths`ê°€ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— `getStaicProps`í•¨ìˆ˜ëŠ” í•„ìˆ˜ë¡œ í˜¸ì¶œë˜ì–´ì•¼í•˜ëŠ” ë„¥ìŠ¤íŠ¸ì˜ ê·œì¹™ë•Œë¬¸ì— ë‚¨ê²¨ë‘¡ë‹ˆë‹¤.

ë‚˜ë¨¸ì§€ íŒŒì¼ì—ì„œ ì‚¬ìš©í•˜ëŠ” `getStaticProps`ëŠ” ì œê±°í•´ë„ ìƒê´€ì—†ìŠµë‹ˆë‹¤.

## Context ìƒì„±ê³¼ ì „ì—­ìœ¼ë¡œ ë°ì´í„° ì‚¬ìš©

```tsx showLineNumbers filename="src/context/post.provider.ts"
import { Article } from "@/util/types";
import React, { createContext, useReducer } from "react";

interface PostValue {
  posts: Article[];
}

interface PostAction {
  type: POST_INIT;
  posts: Article[];
}

const initialValues: PostValue = {
  posts: [],
};

export enum POST_INIT {
  INIT = "post/initial",
}

export const PostContext = createContext({ posts: [] as Article[] });
export const PostDispatchContext = createContext(new Function());

const reducer = (state: PostValue, action: PostAction) => {
  switch (action.type) {
    case POST_INIT.INIT:
      return {
        ...state,
        posts: action.posts,
      };
    default:
      return { ...state };
  }
};

export const PostProvider = ({
  children,
}: {
  children: React.ReactElement;
}) => {
  const [state, dispatch] = useReducer(reducer, initialValues);
  return (
    <PostDispatchContext.Provider value={dispatch}>
      <PostContext.Provider value={state as any}>
        {children}
      </PostContext.Provider>
    </PostDispatchContext.Provider>
  );
};
```

`provider`ë¥¼ `_app.tsx`ì—ì„œ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ê³  ì „ì—­ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ `fetch`í•¨ìˆ˜ë¡œ `posts.json`íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ `POST_INIT`ìœ¼ë¡œ `dispatch`ë¥¼ ë‚ ë ¤ ë°ì´í„° ì´ˆê¸°í™” í•´ì¤ë‹ˆë‹¤.

`posts.json`ì€ ì´í›„ ìë™ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì·¨í•©í•´ì„œ ìƒì„±ë  íŒŒì¼ì´ë¦„ì…ë‹ˆë‹¤.

## gnb ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° fetchí•˜ê¸°

í•„ìì˜ ê²½ìš° ëª¨ë“  í˜ì´ì§€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ì¸ `gnb`ì—ì„œ `posts.json`ì„ ê°€ì ¸ì™€ ì»¨í…ìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•˜ê³ ì í•©ë‹ˆë‹¤.

```tsx showLineNumbers filename="src/components/AppBar.tsx" highlight={1-2}
import { PostDispatchContext, POST_INIT } from "@/context/PostProvider";
import articleJson from "@/database/metapost/posts.json";

function ResponsiveAppBar() {
  const postDispatch = useContext(PostDispatchContext);

  useEffect(() => {
    postDispatch({
      type: POST_INIT.INIT,
      posts: articleJson,
    });
  }, []);

  // ... ì½”ë“œë“¤

  return (
    <AppBar
    // ...options
    ></AppBar>
  );
}
export default ResponsiveAppBar;
```

`postDispatch`ë¥¼ ì´ìš©í•´ `posts.json`ì„ ê°€ì ¸ì™€ ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ì œ ëª¨ë“  í˜ì´ì§€ì—ì„œ `useContext(PostContext)`ë¡œ ë¹Œë“œëœ í¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—…í•˜ëŠ” í™˜ê²½ì— ë”°ë¼ ë¹Œë“œ ì†ë„ê°€ ìƒì´í•˜ì§€ë§Œ ì¸í„°ë„· ì†ë„ê°€ ëŠë¦° ìƒí™©ì—ì„œëŠ” 20ë¶„ê°€ëŸ‰, ë¹ ë¥¸ ìƒí™©ì—ì„œëŠ” 15ë¶„ê°€ëŸ‰ ê±¸ë ¸ìŠµë‹ˆë‹¤.

í˜„ì¬ ì´ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•œ í›„ 2ë¶„ 30ì´ˆë©´ ëª¨ë‘ ë¹Œë“œë˜ê³  ê¹ƒí—ˆë¸Œì— ê³§ë°”ë¡œ ë°°í¬í•˜ì—¬ ì´ 3ë¶„ì´ ì†Œìš”ë©ë‹ˆë‹¤.

ê°œë°œ í™˜ê²½ì—ì„œ ë˜í•œ í˜ì´ì§€ë¥¼ ì´ˆê¸° ë¡œë“œí•˜ëŠ” ì†ë„ê°€ 5ë¶„ì—ì„œ 10ì´ˆëŒ€ë¡œ ì¤„ì–´ ì²´ê° ìƒ ë§¤ìš° ë¹ ë¥¸ ì†ë„ë¡œ ë¡œë“œë˜ëŠ” ê²ƒì„ ê²½í—˜í–ˆìŠµë‹ˆë‹¤.

## ëª¨ë“  í¬ìŠ¤íŠ¸ ë°ì´í„° ì·¨í•© ë° ë¹Œë“œ

ìœ„ ì„¤ì •ì´ ëë‚¬ë‹¤ë©´ ì‹¤ì œë¡œ ë™ì‘í•˜ê¸° ìœ„í•´ í¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì·¨í•©í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë•Œ ë„¥ìŠ¤íŠ¸ì™€ ê°™ì´ ì‹¤í–‰ëœë‹¤ë©´ `type`ì„¤ì •ì— ì˜í•œ ì¶©ëŒì´ ìˆì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë„¥ìŠ¤íŠ¸ì™€ ë³„ê°œë¡œ ë™ì‘í•˜ë„ë¡ í•©ë‹ˆë‹¤.

### ë³„ë„ package.json ì‚¬ìš©

ê¸°ì¡´ package.jsonì€ `type`ì´ `commonjs`ì…ë‹ˆë‹¤. `src/libs/save.postdata.ts`ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ë””ë ‰í† ë¦¬ì— `package.json`ì„ ìƒì„±í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```json showLineNumbers filename="src/libs/package.json" highlight={5}
{
  "name": "blog3-libs",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "cross-env NODE_ENV=development nodemon -e md,mdx -w ../database/ -i ../database/notyet -i ../database/metapost --exec 'node --no-warnings --loader ts-node/esm ./save.postdata.ts'",
    "prod": "cross-env NODE_ENV=production node --no-warnings --loader ts-node/esm ./save.postdata.ts"
  },
  "dependencies": {
    "@mdx-js/loader": "^2.3.0",
    "@mdx-js/react": "^2.3.0",
    "@next/mdx": "^13.4.3",
    "@types/mdx": "^2.0.5",
    "@types/node": "20.2.4",
    "date-fns": "^2.30.0",
    "dayjs": "^1.11.7",
    "glob": "^10.2.6",
    "gray-matter": "^4.0.3",
    "markdown-it": "^13.0.1",
    "next": "13.4.4",
    "next-mdx-remote": "^4.4.1",
    "prismjs": "^1.29.0",
    "reading-time": "^1.5.0",
    "rehype": "^12.0.1",
    "rehype-mdx-code-props": "^1.0.0",
    "remark-breaks": "^3.0.3",
    "sharp": "^0.32.1",
    "typescript": "5.0.4"
  },
  "devDependencies": {
    "rehype-autolink-headings": "^6.1.1",
    "rehype-prism-plus": "^1.5.1",
    "rehype-slug": "^5.1.0",
    "remark-gfm": "^3.0.1",
    "replace-in-files-cli": "^2.2.0",
    "ts-node": "^10.9.1",
    "tslib": "^2.6.2"
  }
}
```

ìœ„ ì‹¤í–‰í™˜ê²½ì€ `src/libs/save.postsdata.ts`ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •ì…ë‹ˆë‹¤. ì´í›„ `root` ë””ë ‰í† ë¦¬ì—ì„œ `concurrently`ì™€ ì—°ê³„í•´ì„œ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤.

ì´ì œ `save.postdata.ts`ë¥¼ ì™„ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

```typescript showLineNumbers filename="src/libs/save.postdata.ts"
import { globSync } from "glob";
import matter from "gray-matter";
import { serialize } from "next-mdx-remote/serialize";
import readingTime from "reading-time";
import rehypeAutolinkHeadings from "rehype-autolink-headings";
import rehypeMdxCodeProps from "rehype-mdx-code-props";
import rehypePrism from "rehype-prism-plus";
import rehypeSlug from "rehype-slug";
import remarkBreaks from "remark-breaks";
import remarkGfm from "remark-gfm";
import fs from "fs";

let totalLen = 0;

const customGlob = (globCondition) => {
  return globSync(globCondition, {
    ignore: ["../database/notyet/*.{md,mdx}"],
    dot: true,
  });
};

const MDX_REMOTE_OPTIONS = {
  parseFrontmatter: true,
  mdxOptions: {
    remarkPlugins: [remarkGfm, remarkBreaks],
    rehypePlugins: [
      rehypeSlug,
      rehypePrism,
      [
        rehypeAutolinkHeadings,
        {
          properties: {
            className: ["anchor"],
          },
        },
      ],
      rehypeMdxCodeProps,
    ],
    format: "mdx",
    development: process.env.NODE_ENV !== "production",
  },
};

const metapostLocation = "../database/metapost/posts.json";

/* metadata save */
(async () => {
  const posts = await findAllArticles();
  const saveCurrent = JSON.stringify(posts, null, 2);
  try {
    console.log("starting mode:", process.env.NODE_ENV);
    const metapost = fs.readFileSync(metapostLocation);
    const metapostJSON = JSON.stringify(
      JSON.parse(metapost.toString() || "[]"),
      null,
      2
    );
    if (saveCurrent !== metapostJSON) {
      fs.rmSync(metapostLocation);
      fs.writeFileSync(metapostLocation, saveCurrent);
      console.log("ğŸ› ï¸ save refresh metapost.json");
    } else {
      throw new Error("now content is same the metapost.json");
    }
  } catch (error) {
    fs.writeFileSync(metapostLocation, saveCurrent);
    console.log("âœ… now is same as before", error);
  } finally {
    console.log("âœ¨ success !");
    process.exit(0);
  }
})();

/* ë‹¨ì¼ í¬ìŠ¤íŠ¸ ì°¾ê¸° - ëª¨ë“ˆ 2 */
async function readFileAndGetSerializedPostMetadata(filePath) {
  const file = fs.readFileSync(filePath, "utf-8");
  const source = await serialize(file.trim(), MDX_REMOTE_OPTIONS);

  const { content, data } = matter(file);
  const mdxData = source || data;

  if (mdxData.frontmatter.published) {
    return {
      ...mdxData,
      content,
      readingTime: readingTime(file).text,
      originPath: filePath,
    };
  } else {
    return null;
  }
}
/* ë‹¨ì¼ í¬ìŠ¤íŠ¸ ì°¾ê¸° - ëª¨ë“ˆ 1 */
async function findAllArticles() {
  const articles = customGlob(`../database/**/*.{md,mdx}`);
  totalLen = articles.length;
  let convert = [];
  for (let i = 0; i < articles.length; i++) {
    const articleSlug = articles[i];
    if (articleSlug.match(/\.md(x)?/)) {
      const article = await readFileAndGetSerializedPostMetadata(articleSlug);
      if (article) convert.push(article);
    }
    console.log(
      "procceding %d% (%d/%d)",
      ((i / totalLen) * 100).toFixed(1),
      i,
      totalLen
    );
  }
  const result = convert.sort((a, b) =>
    b.frontmatter.date.localeCompare(a.frontmatter.date)
  );
  return result;
}
```

ì´ì œ ì €ì¥ í›„ `root`ë””ë ‰í† ë¦¬ì˜ `package.json`ì„ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```diff-json
{
  // ë‹¤ë¥¸ ì„¤ì •ë“¤...,
  "scripts": {
-    "dev": "cross-env next dev"
+    "dev": "concurrently --kill-others-on-fail \"cd src/libs/ && pnpm run dev\" \"cross-env next dev\""
+    "deploy": "npm run build && cd build/ && git init && git add -A && git commit -m \"add post and fixbugs\" && git push -f https://github.com/kkn1125/kkn1125.github.io.git master:gh-pages",
    "build": "cd src/libs/ && pnpm run prod && cd - && next build && npm run set404 && next-sitemap --config next-sitemap.config.js && touch build/.nojekyll",
  },
  // ë‹¤ë¥¸ ì„¤ì •ë“¤...
}
```

ì´ì œ `dev` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ë‘” ì½˜ì†”ë¡œ ë¹Œë“œì˜ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆê³ , mdx,md íŒŒì¼ì„ ì €ì¥í•˜ë©´ ìë™ìœ¼ë¡œ ë¹Œë“œí•˜ê²Œ ë©ë‹ˆë‹¤.

![mdx,md íŒŒì¼ ì €ì¥ í›„ ìë™ ì¶”ì¶œ ì˜ˆì‹œ](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/a779168c-68df-4399-b974-fd079ed43744)

ë¹Œë“œ í›„ ë„¥ìŠ¤íŠ¸ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ ë¬´ì‹œí•´ë„ ë˜ëŠ” ì˜¤ë¥˜ ì…ë‹ˆë‹¤. ì´ëŠ” `posts.json`ì„ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì—ì„œ í•´ë‹¹ íŒŒì¼ ë‚´ìš©ì´ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì´ê³ , ë³€ê²½ëœ `posts.json`ì„ ë‹¤ì‹œ ìë™ìœ¼ë¡œ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— ê¸°ë‹¤ë ¤ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ë„ì–´ì¤ë‹ˆë‹¤.

![í¬ìŠ¤íŠ¸ ìƒì„± í›„ ë„¥ìŠ¤íŠ¸ ì˜¤ë¥˜](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/24470b53-0364-4355-87b5-8cc26710fb83)

ê·¸ë¦¬ê³  í˜ì´ì§€ë¥¼ ë³´ë©´ ì‘ì„±ì¤‘ì´ë˜ mdxê°€ ìµœì‹ í™”ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![ë³€ê²½ ì „](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/a4fa07da-c5b8-4298-b8bd-5bc7b9f397b8)

ìœ„ ë‚´ìš©ì—ì„œ mdxë¥¼ ì €ì¥í•˜ê³ ë‚˜ë©´ ì•„ë˜ì²˜ëŸ¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³§ë°”ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. í•„ìì˜ ê²½ìš° í¬ìŠ¤íŠ¸ê°€ ë¹Œë“œëœ í›„ 2ì´ˆê°€ ì§€ë‚˜ë©´ ì•„ë˜ì²˜ëŸ¼ ë‚´ìš©ì´ ì•Œì•„ì„œ ë³€ê²½ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

![ë³€ê²½ ì ìš© í›„](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/4cde6bde-c970-49d3-8b16-9c626cb354b2)

### ìë™ ë¹Œë“œ

`root`ì˜ `package.json`ì— ì„¤ì •í•œ `deploy`ë¥¼ ì‹¤í–‰í•˜ë©´ ëì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ë¸”ë¡œê·¸ì— ê´‘ê³ ë‚˜ êµ¬ê¸€ ì• ë„ë¦¬í‹±ìŠ¤ë¥¼ ì„¤ì •í•˜ì…¨ë‹¤ë©´ ì¡°ê¸ˆ ì‹ ì¤‘í•˜ê²Œ í…ŒìŠ¤íŠ¸ í›„ ë°°í¬í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

> í¬ìŠ¤íŠ¸ê°€ ì œëŒ€ë¡œ `production`ëª¨ë“œë¡œ ì¶”ì¶œë˜ì—ˆëŠ”ì§€, `serve`ë‚˜ `http-server` íˆ´ì„ ì´ìš©í•´ ëª¨ì˜ë¡œ ì‹¤í–‰í•´ ë³¸ í›„ ë°°í¬í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

ì•„ë˜ëŠ” í”„ë¡œë•ì…˜ìœ¼ë¡œ í¬ìŠ¤íŠ¸ê°€ ì¶”ì¶œì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤.

![productionëª¨ë“œ ì¶”ì¶œ ì§„í–‰](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/aa5f1aee-910f-4b28-b78e-e0f233313433)

![productionëª¨ë“œ ì¶”ì¶œ ì™„ë£Œ](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/4c5e1538-58a2-49d0-87c3-6261877143f8)

![íŒŒì¼ ë‚´ìš© í™•ì¸](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/d977cc56-a73f-46e0-a4cb-c8a619f2bdcb)

íŒŒì¼ ë‚´ìš©ì€ ì‘ì—…í•˜ì‹œëŠ” ë¶„ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” `compileSource`ì™€ `frontmatter`, ê¸°íƒ€ í•„ìš”í•œ ì˜µì…˜ì„ ì¶”ê°€í•œ ë°°ì—´ë¡œ ì¶”ì¶œí•´ì„œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

## ë§ˆë¬´ë¦¬

ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ì¡°ê¸ˆ ê·€ì°®ì€ ì„¤ì •ì´ ì‚¬ì „ì— í•„ìš”í•˜ê¸° ë•Œë¬¸ì— í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ê²½ìš° ìƒí™©ì— ë”°ë¼ ì†ì´ ë§ì´ ê°ˆ ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤. ì†ì´ ë§ì´ ê°€ëŠ” ë§Œí¼ í¬ìŠ¤íŒ…í•˜ê³  ë¸”ë¡œê·¸ë¥¼ ìµœì‹ ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” ì†ë„ê°€ ê·¸ë§Œí¼ ë¹¨ë¼ì§€ë‹ˆ ì ìš© ì•ˆ í•  ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.

í•˜ìœ„ ë””ë ‰í† ë¦¬ì— `package.json`ì„ ìƒì„±í•˜ê³  `nodemon`ì´ í¬ìŠ¤íŠ¸ë¥¼ ìë™ ë¹Œë“œí•˜ëŠ” ë¶€ë¶„ì—ì„œ ê²½ë¡œ ì„¤ì •ê³¼ `watch`ë¥¼ ì–´ë””ë¡œ ë‘ì–´ì•¼ í•  ì§€ ê³ ë¯¼ì„ ë§ì´ í–ˆìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ í¬ìŠ¤íŒ…ì„ ìœ„í•œ ìµœì í™”ì´ê¸° ë•Œë¬¸ì— ê°œë°œí™˜ê²½ì—ì„œì˜ ì‚¬ìš©ì´ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í™•ì‹¤í•˜ê²Œ ë§ì”€ë“œë¦´ ìˆ˜ ìˆëŠ” ê²ƒì€ ì†ë„ê°€ ë§¤ìš° ê°œì„ ë˜ëŠ” ì ì…ë‹ˆë‹¤. ì´ ì™¸ì—ë„ ê°œë°œ í™˜ê²½ì—ì„œ ë¡œë“œí•˜ëŠ” í¬ìŠ¤íŠ¸ ìˆ˜ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì„ ì±„íƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. 100ê°œê°€ ë„˜ì–´ê°€ë©´ ë¡œë“œí•˜ëŠ” ì†ë„ê°€ í™•ì‹¤íˆ ëŠë ¤ì ¸ ì²˜ìŒ ì‹œë„ì—ì„œëŠ” ë¡œë“œí•˜ëŠ” í¬ìŠ¤íŠ¸ ìˆ˜ë¥¼ ìµœì‹  ê¸°ì¤€ìœ¼ë¡œ 10ê°œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‹œë„ë¥¼ í–ˆìŠµë‹ˆë‹¤.

10ê°œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ê·¼ë³¸ì ì¸ ì„±ëŠ¥ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•Šì•„ ì´ë²ˆ ê¸°íšŒì— ì¢‹ì€ ì‹œë„ë¥¼ í–ˆë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤.

ë„¥ìŠ¤íŠ¸ê°€ ê°€ì§„ ê¸°ëŠ¥ ì™¸ ìŠ¤ìŠ¤ë¡œì˜ ìƒê°ëŒ€ë¡œ í•´ê²°í•˜ëŠ” ê²ƒ ë˜í•œ ë‚˜ì˜ì§€ ì•Šë‹¤ê³  ìƒê°ì´ ë©ë‹ˆë‹¤.

ì—¬ê¸°ê¹Œì§€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ˜
