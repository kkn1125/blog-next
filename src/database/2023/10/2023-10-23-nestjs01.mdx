---
slug: "/nestjs01/"
date: 2023-10-24 19:12:45 +0000
modified: 2023-10-24 19:12:45 +0000
title: "[NESTJS] Nest.js í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •í•˜ê¸°"
author: Kimson
categories: [nestjs]
image: /assets/images/post/covers/TIL-nest2.png
tags: [node, nest, framework, basic, til]
description: "Nest.js í”„ë¡œì íŠ¸ ë‹¤ë£¨ê¸°

Nest.js(ì´í•˜ ë„¤ìŠ¤íŠ¸)ëŠ” Spring boot(ì´í•˜ ìŠ¤í”„ë§)ì™€ ì•„ì£¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ìŠ¤í”„ë§ì˜ ì–´ë…¸í…Œì´ì…˜ê³¼ ëŒ€ì‘í•˜ëŠ” ë°ì½”ë ˆì´í„°ì™€ `IoC(ì œì–´ì˜ ì—­ì „)`ì™€ `DI(ì˜ì¡´ì„± ì£¼ì…)` ê°œë…ì´ ì‚¬ìš©ëœë‹¤.

ì„¤ì¹˜ì™€ ì‹¤í–‰

ë„¤ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ `fastify`ë‚˜ `express`ì™€ ë‹¬ë¦¬ ì¢‹ì•˜ë˜ ë¶€ë¶„ì€ ê° ê°œë°œ ë‹¨ìœ„ì˜ í¼(form)ì„ ìƒì„±í•´ì£¼ëŠ” `CLI`ì˜ ê¸°ëŠ¥ì„ ê¼½ì„ ìˆ˜ ìˆë‹¤. í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ëª¨ë“  ê¸°ëŠ¥ì„ `CLI`ê°€ ë– ë¨¹ì—¬ì¤€ë‹¤ê³  í•´ë„ ê³¼ì–¸ì´ ì•„ë‹ˆë‹¤.

ìŠ¤í”„ë§ìœ¼ë¡œ êµ³ì´ ë¹„êµí•´ë³´ìë©´ `initializr`ê°€ ì´ˆê¸° í”„ë¡œì íŠ¸ ì„¸íŒ…ë§Œ í•´ì£¼ëŠ” ë°˜ë©´, ë„¤ìŠ¤íŠ¸ëŠ” ì´ˆê¸° ì„¸íŒ…ì€ ë¬¼ë¡  í™•ì¥ë˜ëŠ” ì•±ê³¼ ì„œë¸Œì•±, ëª¨ë“ˆ ë“±ì„ ìë™ìœ¼ë¡œ ë””ë ‰í† ë¦¬ ìƒì„± ë° íŒŒì¼ ë‚´ìš©ì„ ì‘ì„±í•˜ê³  ì„í¬íŠ¸í•´ì¤€ë‹¤. ì–¼ë§ˆë‚˜ íš¨ìœ¨ì ì¸ê°€? ğŸ˜®"
featured: true
rating: 4.5
profile: false
published: true
---

# Nest.js í”„ë¡œì íŠ¸ ë‹¤ë£¨ê¸°

Nest.js(ì´í•˜ ë„¤ìŠ¤íŠ¸)ëŠ” Spring boot(ì´í•˜ ìŠ¤í”„ë§)ì™€ ì•„ì£¼ ìœ ì‚¬í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ìŠ¤í”„ë§ì˜ ì–´ë…¸í…Œì´ì…˜ê³¼ ëŒ€ì‘í•˜ëŠ” ë°ì½”ë ˆì´í„°ì™€ `IoC(ì œì–´ì˜ ì—­ì „)`ì™€ `DI(ì˜ì¡´ì„± ì£¼ì…)` ê°œë…ì´ ì‚¬ìš©ëœë‹¤.

## ì„¤ì¹˜ì™€ ì‹¤í–‰

ë„¤ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ `fastify`ë‚˜ `express`ì™€ ë‹¬ë¦¬ ì¢‹ì•˜ë˜ ë¶€ë¶„ì€ ê° ê°œë°œ ë‹¨ìœ„ì˜ í¼(form)ì„ ìƒì„±í•´ì£¼ëŠ” `CLI`ì˜ ê¸°ëŠ¥ì„ ê¼½ì„ ìˆ˜ ìˆë‹¤. í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ”ë° í•„ìš”í•œ ëª¨ë“  ê¸°ëŠ¥ì„ `CLI`ê°€ ë– ë¨¹ì—¬ì¤€ë‹¤ê³  í•´ë„ ê³¼ì–¸ì´ ì•„ë‹ˆë‹¤.

ìŠ¤í”„ë§ìœ¼ë¡œ êµ³ì´ ë¹„êµí•´ë³´ìë©´ `initializr`ê°€ ì´ˆê¸° í”„ë¡œì íŠ¸ ì„¸íŒ…ë§Œ í•´ì£¼ëŠ” ë°˜ë©´, ë„¤ìŠ¤íŠ¸ëŠ” ì´ˆê¸° ì„¸íŒ…ì€ ë¬¼ë¡  í™•ì¥ë˜ëŠ” ì•±ê³¼ ì„œë¸Œì•±, ëª¨ë“ˆ ë“±ì„ ìë™ìœ¼ë¡œ ë””ë ‰í† ë¦¬ ìƒì„± ë° íŒŒì¼ ë‚´ìš©ì„ ì‘ì„±í•˜ê³  ì„í¬íŠ¸í•´ì¤€ë‹¤. ì–¼ë§ˆë‚˜ íš¨ìœ¨ì ì¸ê°€? ğŸ˜®

```bash showLineNumbers
npm i -g @nestjs/cli

nest new my-project

# ë” ì—„ê²©í•œ ê¸°ëŠ¥ ì„¸íŠ¸ë¥¼ ìœ„í•œ ê²½ìš°
nest new --strict my-project
```

í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆë‹¤ë©´ í”„ë¡œì íŠ¸ë¡œ ì´ë™í•´ì„œ ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰í•œë‹¤. í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ëŠ” ì‹œì ì— ì´ë¯¸ `node_modules`ë„ ì„¤ì¹˜ë˜ê¸° ë•Œë¬¸ì— ë”°ë¡œ `npm install`í•  í•„ìš”ê°€ ì—†ë‹¤.

```bash
cd my-project

npm run start:dev
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì–´ë–¤ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë˜ íŒŒì•…ì´ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•œë‹¤. ì´ê²ƒì€ ë°±ì—”ë“œ ë§Œì˜ ë¬¸ì œëŠ” ì•„ë‹ˆë¼ ëª¨ë“  ì˜ì—­ì—ì„œ ì¤‘ìš”í•œ í•µì‹¬ì´ ì•„ë‹ê¹Œ.

```plaintext
â””â”¬Â  ğŸ“‚ root/
 â”œâ”¬Â  ğŸ“‚ src/
 â”‚â”œâ”¬Â  ğŸ“‚ board/
 â”‚â”‚â”œâ”¬Â  ğŸ“‚ dto/
 â”‚â”‚â”‚â”œâ”€Â  ğŸ“„ create-board.dto.ts
 â”‚â”‚â”‚â””â”€Â  ğŸ“„ update-board.dto.ts
 â”‚â”‚â””â”¬Â  ğŸ“‚ entities/
 â”‚â”‚ â”œâ”€Â  ğŸ“„ board.controller.spec.ts
 â”‚â”‚ â”œâ”€Â  ğŸ“„ board.controller.ts
 â”‚â”‚ â”œâ”€Â  ğŸ“„ board.module.ts
 â”‚â”‚ â”œâ”€Â  ğŸ“„ board.service.spec.ts
 â”‚â”‚ â””â”€Â  ğŸ“„ board.srevice.ts
 â”‚â”œâ”€Â  ğŸ“„ app.module.ts
 â”‚â””â”€Â  ğŸ“„ main.ts
 â”œâ”¬Â  ğŸ“‚ test/
 â”‚â”œâ”€Â  ğŸ“„ app.e2e-spec.ts
 â”‚â””â”€Â  ğŸ“„ jest-e2e.json
 â”œâ”€Â  ğŸ“„ .env
 â”œâ”€Â  ğŸ“„ .eslintrc.js
 â”œâ”€Â  ğŸ“„ .gitignore
 â”œâ”€Â  ğŸ“„ .prettierrc
 â”œâ”€Â  ğŸ“„ nest-cli.json
 â”œâ”€Â  ğŸ“„ package.json
 â”œâ”€Â  ğŸ“„ README.md
 â””â”€Â  ğŸ“„ tsconfig.json
```

í•„ìëŠ” `resource`ë¥¼ ìƒì„±í•´ì„œ ê°„ë‹¨í•œ `CRUD`ë¥¼ êµ¬í˜„í•  ê²ƒì´ê¸° ë•Œë¬¸ì— `app.controller.ts`ì™€ `app.service.ts`ëŠ” ì§€ìš´ë‹¤.

```bash
nest g resource board
```

ì œì¼ ë§Œë§Œí•œ ê²Œì‹œíŒì„ ì œì‘í•˜ê¸° ìœ„í•´ board ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•œë‹¤. ì•„ì£¼ ë†€ëê²Œë„ ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ì— ì´ì–´ì„œ ì—”í‹°í‹°ì™€ DTOë¥¼ ë¬´ë ¤ ìƒì„±, ìˆ˜ì • í¬ë§·ì— ë§ê²Œ ì´ˆê¸°í™” í•´ì¤€ë‹¤. ì•„ë˜ ì´ë¯¸ì§€ì—ì„œ ìƒì„±ë˜ëŠ” ë¶€ë¶„ë§Œ ì…€ë ‰íŠ¸ í–ˆë‹¤. ë‚˜ë¨¸ì§€ëŠ” ê³µë¶€ ê³¼ì •ì— ìƒê¸´ ê²ƒì´ê¸° ë•Œë¬¸ì— ì„¤ëª…ì€ ìƒëµí•œë‹¤.

![ë¦¬ì†ŒìŠ¤ ìƒì„± í›„](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/16e0882c-4e8e-443b-b18c-a5360dadac7a)

ì´ì œë¶€í„° ê²Œì‹œíŒì„ ì œì‘í•˜ë©´ì„œ í•„ìš”í•œ ë¡œê±°ì™€ í™˜ê²½ë³€ìˆ˜, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ê³¼ í…ŒìŠ¤íŠ¸ í™˜ê²½ì„¤ì •ê¹Œì§€ ë‹¤ì´ë ‰íŠ¸ë¡œ ì§„í–‰í•œë‹¤.

## í™˜ê²½ë³€ìˆ˜ ì„¤ì •

í™˜ê²½ë³€ìˆ˜ëŠ” `.env`ì— ì •ì˜í•˜ì—¬ ì‚¬ìš©ë˜ëŠ”ë°, ë„¤ìŠ¤íŠ¸ëŠ” `configuration`ì´ë¼ëŠ” ê¸°ìˆ ì„ ì œê³µí•˜ë©°, í•´ë‹¹ íŒ¨í‚¤ì§€ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `dotenv`ë¥¼ ì‚¬ìš©í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ê¸ì–´ì˜¤ê¸° ë•Œë¬¸ì— ì„¤ì • ë˜í•œ ì‰½ê³  ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

> ì—¬ê¸°ì„œ ëª¨ë“ˆì— ê´€ë ¨ëœ ë‚´ìš©ì´ ì´í•´ê°€ì§€ ì•Šìœ¼ë©´ [ê³µì‹ë¬¸ì„œ](https://docs.nestjs.com/modules)ë¥¼ ì„ í–‰í•´ì•¼í•œë‹¤.

### ê¸°ë³¸ì ì¸ ë°©ë²•

```typescript showLineNumbers filename="src/main.ts"
import { Module } from "@nestjs/common";
import { ConfigModule } from "@nestjs/config";

@Module({
  imports: [ConfigModule.forRoot()],
})
export class AppModule {}
```

ì¸ì ì—†ì´ `forRoot()`ë¡œ ì‚¬ìš©í•˜ë©´ `.env`ì˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ê¸ì–´ì˜¤ê³ , ê°œë°œí™˜ê²½ì´ë‚˜ í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ íŒŒì¼ì˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ë³„ë„ë¡œ ê²½ë¡œë¥¼ ì§€ì •í•´ ì—¬ëŸ¬ ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```diff-typescript showLineNumbers filename="src/main.ts"
import { Module } from "@nestjs/common";
import { ConfigModule } from "@nestjs/config";

@Module({
-   imports: [ConfigModule.forRoot()],
+   imports: [ConfigModule.forRoot({
+     envFilePath: ['.env.development.local', '.env.development'],
+   })],
})
export class AppModule {}
```

ê·¸ë ‡ë‹¤ë©´ í™˜ê²½ë³€ìˆ˜ë¥¼ `process.env.*`ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œë°, í•„ìì˜ ê²½ìš° ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ì„ ë§Œë“¤ì–´ ì‚¬ìš©í–ˆì§€ë§Œ `ConfigService`ë¥¼ í†µí•´ ê° ëª¨ë“ˆ ë³„ë¡œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë ¤ í•œë‹¤.

### í™˜ê²½ë³€ìˆ˜ ì£¼ì…

ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ì£¼ì…í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ globalë¡œ ì„¤ì •í•˜ì§€ ì•Šê³ , ê°œë³„ í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì„ ì›í•˜ëŠ” ëª¨ë“ˆì— ì£¼ì…í•˜ì—¬ ì‚¬ìš©í•  ë•Œ ìœ ìš©í•˜ë‹¤. ì£¼ì…í•  ë•ŒëŠ” ë‹¨ìˆœíˆ ì£¼ì…í•˜ì—¬ ê¸°ì¡´ì˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§€ì •í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ê·¸ë£¹í•˜ì—¬ ì‚¬ìš©í•œ ìˆ˜ ìˆë‹¤.

```typescript filename="src/config/database.config.ts" showLineNumbers
export default registerAs("database", () => ({
  host: process.env.DATABASE_HOST,
  port: +(process.env.DATABASE_PORT || 3306),
}));
```

```diff-typescript filename="src/app.module.ts" showLineNumbers
import databaseConfig from './config/database.config';

@Module({
  imports: [
-   envFilePath: ['.env.development.local', '.env.development'],
+   ConfigModule.forRoot({
+     load: [databaseConfig],
+   }),
  ],
})
export class AppModule {}
```

í•´ë‹¹ ëª¨ë“ˆ ë‚´ì—ì„œëŠ” ì§€ì •í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```typescript highlight={1,8,17} showLineNumbers filename="src/board/board.controller.ts"
import { ConfigService } from "@nestjs/config";
// ...

@Injectable()
export class BoardController {
  constructor(
    private readonly boardService: BoardService,
    private readonly configService: ConfigService,
    private readonly logger: CustomLoggerService
  ) {}

  @Get()
  findAll(@Query("page") page: number) {
    const boards = this.boardService.findAll({
      page,
    });
    const dbHost = this.configService.get<string>("database.host");
    return boards;
  }
}
```

ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì„œë¹„ìŠ¤ì— ì‚¬ìš©ë˜ê¸°ë³´ë‹¤ ë°ì´í„°ë² ì´ìŠ¤ì— ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ì´ë¯€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì†ì„±ì— ì‚¬ìš©í•´ë³´ì.

## Database ì—°ê²°

```bash
nest g mo database
```

ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆì„ ìƒì„±í•˜ê³  ê°™ì€ ë””ë ‰í† ë¦¬ì— `database.configuration.ts`ë¥¼ ìƒì„±í•œë‹¤. íŒŒì¼ëª…ì€ ë‹¤ë¥¸ ì´ë¦„ì´ì–´ë„ ì¢‹ë‹¤.

```typescript filename="src/database/database.configuration.ts" showLineNumbers
import { Injectable } from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { TypeOrmModuleOptions, TypeOrmOptionsFactory } from "@nestjs/typeorm";

@Injectable()
export class DatabaseConfigurationService implements TypeOrmOptionsFactory {
  constructor(private readonly configService: ConfigService) {}

  createTypeOrmOptions(): TypeOrmModuleOptions {
    return {
      type: "mariadb",
      host: this.configService.get("database.host"),
      port: +this.configService.get("database.port"),
      username: this.configService.get("database.username"),
      password: this.configService.get("database.password"),
      database: this.configService.get("database.database"),
      entities: [__dirname + "/../**/*.entity{.ts,.js}"],
      synchronize: false,
      timezone: this.configService.get("database.timezone"),
    };
  }
}
```

ìœ„ì—ì„œ ì„¤ëª…í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— `configService`ë¥¼ ë°”ë¡œ ì‚¬ìš©í•´ì„œ `database.*`ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

`createTypeOrmOptions`ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆì—ì„œ `import`í•œë‹¤.

```typescript filename="src/database/database.module.ts" showLineNumbers
import { Module } from "@nestjs/common";
import { TypeOrmModule } from "@nestjs/typeorm/dist";
import { DatabaseConfigurationService } from "./database.configuration";

@Module({
  imports: [
    TypeOrmModule.forRootAsync({
      useClass: DatabaseConfigurationService,
    }),
  ],
})
export class DatabaseModule {}
```

`forRootAsync`ë¥¼ í•´ì£¼ëŠ” ì´ìœ ëŠ” í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ë‚˜ ë‹¤ë¥¸ ì˜ì¡´ì„±ì´ ì„¤ì •ë˜ëŠ” ë™ì•ˆ ë™ì‹œì„± ë¬¸ì œë¡œ ì¤‘ê°„ì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. ê°€ë ¹, í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ìœ„í•´ ì†ì„±ì„ ì •ì˜í•œë‹¤ë©´ ê°’ì´ ì—†ì„ ê²½ìš°ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

`app.module.ts`ë¥¼ í†µí•´ì„œ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì— `DatabaseModule`ì„ `import`í•´ì¤€ë‹¤.

```typescript filename="src/app.module.ts" showLineNumbers
import { Module } from "@nestjs/common";
import { ConfigModule } from "@nestjs/config";
import { BoardModule } from "./board/board.module";
import databaseConfig from "./config/database.config";
import { DatabaseModule } from "./database/database.module";

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      envFilePath: [".env"],
      load: [databaseConfig],
    }),
    DatabaseModule,
    BoardModule,
  ],
  controllers: [],
  providers: [],
})
export class AppModule {}
```

ê·¸ ë‹¤ìŒì€ `board.module.ts`ì— `Repository`ë¥¼ `import`í•œë‹¤.

```typescript filename="src/board/board.module.ts" showLineNumbers
import { Module } from "@nestjs/common";
import { TypeOrmModule } from "@nestjs/typeorm/dist";
import { BoardController } from "./board.controller";
import { BoardService } from "./board.service";
import { Board } from "./entities/board.entity";

@Module({
  imports: [TypeOrmModule.forFeature([Board])],
  controllers: [BoardController],
  providers: [BoardService],
})
export class BoardModule {}
```

## Logger ì„¤ì •

ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ìƒì„±í•˜ê³ ì í–ˆì§€ë§Œ ì´ë¯¸ ë„¤ìŠ¤íŠ¸ì—ì„œ ì˜ ë§Œë“¤ì–´ë†“ì€ ë¡œê±°ê°€ ìˆìœ¼ë‹ˆ í™œìš©í•˜ë„ë¡ í•˜ì. í˜¹ì€ í•„ìš”ì— ë”°ë¼ ë¡œê·¸ íŒŒì¼ì„ ë§Œë“¤ì–´ ê¸°ë¡ íŒŒì¼ì„ ë‚´ë³´ë‚´ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

ë¡œê±°ëŠ” ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì„œ ì›í•˜ëŠ” ê³³ì— ìƒì„±ìë¡œ ì£¼ì…í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

```bash showLineNumbers
nest g mo logger
nest g service logger
```

`CLI`ë¡œ ëª¨ë“ˆê³¼ ì„œë¹„ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.

```typescript showLineNumbers filename="src/logger/logger.service.ts"
import { ConsoleLogger, Injectable } from "@nestjs/common";

@Injectable()
export class CustomLoggerService extends ConsoleLogger {
  /**
   * Write a 'log' level log.
   */
  log(message: any, ...optionalParams: any[]) {
    super.log(message, ...optionalParams);
  }

  /**
   * Write an 'error' level log.
   */
  error(message: any, ...optionalParams: any[]) {
    super.error(message, ...optionalParams);
  }

  /**
   * Write a 'warn' level log.
   */
  warn(message: any, ...optionalParams: any[]) {
    super.warn(message, ...optionalParams);
  }

  /**
   * Write a 'debug' level log.
   */
  debug(message: any, ...optionalParams: any[]) {
    super.debug(message, ...optionalParams);
  }

  /**
   * Write a 'verbose' level log.
   */
  verbose(message: any, ...optionalParams: any[]) {
    super.verbose(message, ...optionalParams);
  }
}
```

`ConsoleLogger`ë¥¼ ìƒì†í•˜ê³  ì˜¤ë²„ë¼ì´ë“œí•˜ëŠ”ë° í•„ìš”ì— ë”°ë¼ ì»¤ìŠ¤í…€í•˜ë©´ ëœë‹¤.

```typescript showLineNumbers filename="src/logger/logger.module.ts"
import { Module } from "@nestjs/common";
import { CustomLoggerService } from "./logger.service";

@Module({
  providers: [CustomLoggerService],
  exports: [CustomLoggerService],
})
export class LoggerModule {}
```

ë¡œê±° ëª¨ë“ˆì—ì„œ `providers`ì— ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ê³µê¸‰í•˜ê³ , `exports`ì— ì¶”ê°€í•˜ì—¬ ë…¸ì¶œì‹œí‚¨ë‹¤. ë…¸ì¶œëœ ëª¨ë“ˆì€ ë¡œê±°ë¥¼ ì‚¬ìš©í•  ëª¨ë“ˆì—ì„œ `import`í•˜ì—¬ ì‚¬ìš©í•˜ê³ , ì„¤ì •í•œ ë¡œê±°ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ `main.ts`ì—ì„œ ë¡œê±° ì„œë¹„ìŠ¤ë¥¼ ë“±ë¡ì‹œì¼œì•¼í•œë‹¤.

```typescript showLineNumbers filename="src/main.ts" highlight={4,9,11,14}
import { ConfigService } from "@nestjs/config/dist";
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";
import { CustomLoggerService } from "./logger/logger.service";
import { UserService } from "./user/user.service";

async function bootstrap() {
  const app = await NestFactory.create(AppModule, {
    bufferLogs: true,
  });
  const logger = app.get(CustomLoggerService);

  app.setGlobalPrefix("api");
  app.useLogger(logger);

  const configService: ConfigService = app.get<ConfigService>(ConfigService);
  const port = configService.get("PORT", 5000);

  await app.listen(port);

  logger.log("server listening on port " + port);
}
bootstrap();
```

`11ë¼ì¸`ì˜ `app.useLogger`ëŠ” ë„¤ìŠ¤íŠ¸ê°€ ì¶œë ¥í•˜ëŠ” ë¡œê±°ë¥¼ ì»¤ìŠ¤í…€ë¡œê±°ë¡œ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤. `main.ts`ëŠ” ë‹¨ì§€ ê¸°ë³¸ ë¡œê±°ë¥¼ ì»¤ìŠ¤í…€ë¡œê±°ë¡œ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì„ í•˜ëŠ” ê²ƒì´ì§€ ëª¨ë“  ëª¨ë“ˆì— `import`í•˜ëŠ” ë¡œê±° ëª¨ë“ˆê³¼ëŠ” ìƒê´€ì—†ë‹¤. ê° ëª¨ë“ˆì—ì„œ ë¡œê±°ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `import`ê°€ í•„ìˆ˜ì´ë‹¤.

## Authentication

ì¸ì¦í•˜ê¸° ìœ„í•´ `JWT`ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤. ì¸ì¦ê³¼ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë„¤ìŠ¤íŠ¸ê°€ ì œê³µí•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ì˜ ì„±ê²©ì¸ `Guard(ì´í•˜ ê°€ë“œ)`ë¥¼ ì‚¬ìš©í•œë‹¤.

### í•„ìš”í•œ ìŠ¤í‚¤ë§ˆ ìƒì„±

ë³„ë„ë¡œ ëª¨ë“ˆê³¼ ì„œë¹„ìŠ¤, ê°€ë“œë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•œë‹¤.

```bash showLineNumbers
nest g mo auth
nest g co auth
nest g s auth
nest g gu auth
```

ë¨¼ì € ê°€ë“œë¥¼ ì„¤ì •í•œë‹¤. ì´ë•Œ `CanActive`ë¥¼ ìƒì†ë°›ì•„ `canActive` ë©”ì„œë“œë¥¼ ì •ì˜í•œë‹¤. í•´ë‹¹ ë‚´ìš©ì€ [ë„¤ìŠ¤íŠ¸ í™ˆí˜ì´ì§€ì˜ auth guard](https://docs.nestjs.com/security/authentication#implementing-the-authentication-guard)ì„¤ì • ê·¸ëŒ€ë¡œë¥¼ ê°€ì ¸ì˜¨ í›„ ì¡°ê¸ˆ ë³€ê²½í–ˆë‹¤.

```diff-typescript showLineNumbers filename="src/auth/auth.guard.ts"
import {
  CanActivate,
  ExecutionContext,
  Injectable,
  UnauthorizedException,
} from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { JwtService } from "@nestjs/jwt";
import { CustomLoggerService } from "@src/logger/logger.service";
import { Request } from "express";

@Injectable()
export class AuthGuard implements CanActivate {
  constructor(
    private jwtService: JwtService,
    private configService: ConfigService,
    private readonly logger: CustomLoggerService
  ) {}

  async canActivate(context: ExecutionContext): Promise<boolean> {
    const request = context.switchToHttp().getRequest();
    const token = this.extractTokenFromHeader(request);
    if (!token) {
      throw new UnauthorizedException();
    }
    try {
-     const payload = await this.jwtService.verifyAsync(
-       token,
-       {
-         secret: jwtConstants.secret
-       }
-     );
+     const payload = await this.jwtService.verifyAsync(token, {
+       secret: this.configService.get("jwt.secret"),
+     });
      // ğŸ’¡ We're assigning the payload to the request object here
      // so that we can access it in our route handlers
      request["user"] = payload;
    } catch {
      throw new UnauthorizedException();
    }
    return true;
  }

  private extractTokenFromHeader(request: Request): string | undefined {
    const [type, token] = request.headers.authorization?.split(" ") ?? [];
    return type === "Bearer" ? token : undefined;
  }
}
```

ê·¸ ë‹¤ìŒ ì„œë¹„ìŠ¤ì™€ ì»¨íŠ¸ë¡¤ëŸ¬, ëª¨ë“ˆ ìˆœì„œë¡œ ì„¤ì •í•  ê²ƒì´ë‹¤. ì„œë¹„ìŠ¤ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë„¤ìŠ¤íŠ¸ ë„íë¨¼íŠ¸ë¥¼ ì°¸ê³ í•œë‹¤.

### ì„œë¹„ìŠ¤ ì„¤ì •

```typescript showLineNumbers filename="src/auth/auth.service.ts" highlight={2,10,26}
import { Injectable, UnauthorizedException } from "@nestjs/common";
import { JwtService } from "@nestjs/jwt";
import { CustomLoggerService } from "@src/logger/logger.service";
import { UserService } from "@src/user/user.service";

@Injectable()
export class AuthService {
  constructor(
    private readonly userService: UserService,
    private readonly jwtService: JwtService,
    private readonly logger: CustomLoggerService
  ) {}

  async signIn(email: string, password: string) {
    const user = await this.userService.findOneByEmail(email);
    this.logger.debug("get user data", JSON.stringify(user, null, 2));
    if (user.password !== password) {
      throw new UnauthorizedException();
    }
    const payload = {
      sub: user.id,
      email: user.email,
    };

    this.logger.debug("check value", email, password);
    return { access_token: await this.jwtService.signAsync(payload) };
  }
}
```

`access_token`ì„ ë‚´ë³´ë‚´ëŠ” ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

### ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì •

```typescript showLineNumbers filename="src/auth/auth.contoller.ts" highlight={12,29}
import {
  Body,
  Controller,
  Get,
  HttpCode,
  HttpStatus,
  Post,
  Request,
  UseGuards,
} from "@nestjs/common";
import { CustomLoggerService } from "@src/logger/logger.service";
import { AuthGuard } from "./auth.guard";
import { AuthService } from "./auth.service";

@Controller("auth")
export class AuthController {
  constructor(
    private readonly authService: AuthService,
    private readonly logger: CustomLoggerService
  ) {}

  @HttpCode(HttpStatus.OK)
  @Post("signin")
  signIn(@Body() signInDto: Record<string, any>) {
    this.logger.debug("signInDto", signInDto);
    return this.authService.signIn(signInDto.email, signInDto.password);
  }

  @UseGuards(AuthGuard)
  @Get("profile")
  getProfile(@Request() req) {
    return req.user;
  }
}
```

`getProfile`ì€ `AuthGuard`ë¥¼ í†µí•´ ìš”ì²­ì´ ì˜¤ë©´ í—¤ë”ì— ë‹´ê¸´ `Authentication` ì†ì„±ì„ ë³´ê³  ìœ íš¨í•œ ê°’ì¸ì§€ ì²´í¬ í›„ì— ìš”ì²­ì„ í—ˆë½í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹œë‹¤.

![ê°€ë“œ ë™ì‘ ë„ì‹í™”](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/84985d74-5342-4a0c-a6d2-aaebe9cbe3a2)

í—¤ë”ì˜ í† í° ê°’ì´ ìœ íš¨í•˜ë©´ ê°€ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œê°€ ìš”ì²­ì„ ë°›ì•„ë“¤ì´ëŠ” ë°©ì‹ì´ë‹¤. ìš”ì²­ì„ ë°›ìœ¼ë©´ ê°€ë“œëŠ” ë°©ê¸ˆ ì •ì˜í–ˆë˜ `canActive`ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ í—¤ë”ì˜ í† í°ì„ ì¶”ì¶œí•˜ê³  `request`ì˜ `user`ì†ì„±ì— ì €ì¥í•˜ë©° ê²€ì¦í•œë‹¤. í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•´ì„œëŠ” `signin`ë©”ì„œë“œë¥¼ ê±°ì³ ë°œê¸‰ ë°›ëŠ”ë‹¤. ì°¸ê³ ë¡œ `user`ì†ì„±ì€ `@UseGuard`ë¥¼ ì‚¬ìš©í•œ ë©”ì„œë“œì—ì„œë§Œ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥í•˜ë‹¤.

### ëª¨ë“ˆ ì„¤ì •

ì•„ë˜ ëª¨ë“ˆì„ ì„¤ì •í•˜ê¸°ì— ì•ì„œ jwt ì‹œí¬ë¦¿ì„ ì„¤ì •í•˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ë³„ë„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ìœ„ì—ì„œ ì„¤ì •í•œ `configuration`ì„ ìƒê¸°í•˜ë©´ì„œ ê°ì ì‘ì„±í•´ë³´ì.

```typescript showLineNumbers filename="src/auth/auth.module.ts"
import { Module } from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { JwtModule } from "@nestjs/jwt/dist";
import { LoggerModule } from "@src/logger/logger.module";
import { UserModule } from "@src/user/user.module";
import { AuthController } from "./auth.controller";
import { AuthService } from "./auth.service";

@Module({
  imports: [
    JwtModule.registerAsync({
      global: true,
      inject: [ConfigService],
      useFactory: (configService: ConfigService) => ({
        secret: configService.get("jwt.secret"),
        signOptions: { expiresIn: "1d" },
      }),
    }),
    LoggerModule,
    UserModule,
  ],
  controllers: [AuthController],
  providers: [AuthService],
  exports: [AuthService],
})
export class AuthModule {}
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ê³  ë‚˜ë©´ ëì´ë‹¤. ë§Œì¼ ê²Œì‹œíŒì„ ë¡œê·¸ì¸ ìœ ì €ì— í•œí•´ì„œ ì‘ì„±ë˜ë„ë¡ í•´ì•¼í•œë‹¤ë©´ `board.controller`ì—ì„œ `UseGuard`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•˜ë©´ ëœë‹¤. ë³„ë„ì˜ ëª¨ë“ˆì„ `import`í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

## Testing

í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ë©´ì„œ í…ŒìŠ¤íŒ…ì€ ë¹ ì§ˆ ìˆ˜ ì—†ë‹¤ê³  ìƒê°í•œë‹¤. ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¶€í„° ì¢…ë‹¨ í…ŒìŠ¤íŠ¸ ê¹Œì§€ ì„¤ì •í•´ë³´ì.

### Serevice Test

ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì„¤ì •ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```typescript showLineNumbers filename="src/board/board.service.spec.ts"
import { Test, TestingModule } from "@nestjs/testing";
import { getRepositoryToken } from "@nestjs/typeorm";
import { ApiResponseModule } from "@src/api.response/api.response.module";
import { LoggerModule } from "@src/logger/logger.module";
import { User } from "@src/user/entities/user.entity";
import { Repository } from "typeorm";
import { BoardService } from "./board.service";
import { CreateBoardDto } from "./dto/create-board.dto";
import { Board } from "./entities/board.entity";

const boards = [
  {
    id: 1,
    title: "test1",
    content: "test content",
    author: 1,
    deleted_at: null,
    created_at: "2023-10-23 12:53",
    updated_at: "2023-10-23 12:53",
  },
  {
    id: 2,
    title: "test2",
    content: "test2 content",
    author: 1,
    deleted_at: null,
    created_at: "2023-10-23 12:53",
    updated_at: "2023-10-23 12:53",
  },
];

const createdData = {
  title: "test3",
  content: "test3 content",
  user: { id: 2 } as User,
};

const mockBoardRepository = () => ({
  insert: jest.fn().mockImplementation((dto: CreateBoardDto) =>
    Promise.resolve(
      boards.push({
        id: 3,
        title: dto.title,
        content: dto.content,
        author: 2,
        deleted_at: null,
        created_at: "2023-10-23 12:53",
        updated_at: "2023-10-23 12:53",
      })
    )
  ),
  save: jest.fn(),
  find: jest.fn().mockResolvedValue(boards),
  findOne: jest
    .fn()
    .mockImplementation((id: { where: { id: number } }) =>
      Promise.resolve(boards.find((board) => board.id === id.where.id))
    ),
  softDelete: jest.fn(),
});

type MockRepository<T = any> = Partial<Record<keyof Repository<T>, jest.Mock>>;

describe("BoardService", () => {
  let service: BoardService;
  let boardRepository: MockRepository<Board>;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      imports: [ApiResponseModule, LoggerModule],
      providers: [
        BoardService,
        {
          provide: getRepositoryToken(Board),
          useValue: mockBoardRepository(),
        },
      ],
    }).compile();

    service = module.get<BoardService>(BoardService);
    boardRepository = module.get<MockRepository<Board>>(
      getRepositoryToken(Board)
    );
  });

  afterAll(() => {});

  it("should be defined", () => {
    expect(service).toBeDefined();
    expect(boardRepository).toBeDefined();
  });

  it("test find", async () => {
    const boards = await service.findAll({ page: 1 });
    expect(boards.data.length).toStrictEqual(2);
  });

  it("test findOne", async () => {
    const board = await service.findOne(2);
    expect(board.title).toStrictEqual("test2");
  });

  it("test create", async () => {
    /* const board =  */ await service.create(createdData);
    const boards = await service.findAll({ page: 1 });
    const found = boards.data.find(
      (board) => board.title === createdData.title
    );
    expect(found.id).toStrictEqual(3);
  });
});
```

### Controller Test

ë‹¤ìŒì€ ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ ì„¤ì •ì´ë‹¤.

```typescript showLineNumbers filename="src/board/board.controller.spec.ts"
import { Test, TestingModule } from "@nestjs/testing";
import { getRepositoryToken } from "@nestjs/typeorm";
import { ApiResponseModule } from "@src/api.response/api.response.module";
import { LoggerModule } from "@src/logger/logger.module";
import { Repository } from "typeorm";
import { BoardController } from "./board.controller";
import { BoardService } from "./board.service";
import { CreateBoardDto } from "./dto/create-board.dto";
import { Board } from "./entities/board.entity";

const boards = [
  {
    id: 1,
    title: "test1",
    content: "test content",
    author: 1,
    deleted_at: null,
    created_at: "2023-10-23 12:53",
    updated_at: "2023-10-23 12:53",
  },
  {
    id: 2,
    title: "test2",
    content: "test2 content",
    author: 1,
    deleted_at: null,
    created_at: "2023-10-23 12:53",
    updated_at: "2023-10-23 12:53",
  },
];

const createdData = {
  title: "test3",
  content: "test3 content",
  author: 2,
};

const boardProvideValues = () => ({
  insert: jest.fn().mockImplementation((dto: CreateBoardDto) =>
    Promise.resolve(
      boards.push({
        id: 3,
        title: dto.title,
        content: dto.content,
        author: dto.user.id,
        deleted_at: null,
        created_at: "2023-10-23 12:53",
        updated_at: "2023-10-23 12:53",
      })
    )
  ),
  save: jest.fn(),
  find: jest.fn().mockResolvedValue(boards),
  findOne: jest
    .fn()
    .mockImplementation((id: { where: { id: number } }) =>
      Promise.resolve(boards.find((board) => board.id === id.where.id))
    ),
  softDelete: jest.fn(),
});

type MockRepository<T = any> = Partial<Record<keyof Repository<T>, jest.Mock>>;

describe("BoardController", () => {
  let controller: BoardController;
  let service: BoardService;
  let boardRepository: MockRepository<Board>;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      imports: [ApiResponseModule, LoggerModule],
      controllers: [BoardController],
      providers: [
        BoardService,
        {
          provide: getRepositoryToken(Board),
          useValue: boardProvideValues(),
        },
      ],
    }).compile();

    controller = module.get<BoardController>(BoardController);
    service = module.get<BoardService>(BoardService);
    boardRepository = module.get<MockRepository<Board>>(
      getRepositoryToken(Board)
    );
    // app = module.createNestApplication();
    // const connection = app.get(Connection);
  });

  afterEach(async () => {});

  it("should be defined", () => {
    expect(controller).toBeDefined();
    expect(service).toBeDefined();
    expect(boardRepository).toBeDefined();
  });

  it("findAll", async () => {
    const response = await controller.findAll(1);
    expect(await controller.findAll(1)).toStrictEqual(response);
  });
});
```

ì„œë¹„ìŠ¤ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ê²½ìš° `RepositoryToken`ì„ ì‚¬ìš©í•´ì„œ `Repository`ë¥¼ ë³„ë„ë¡œ ì‘ì„±í•´ì£¼ê³  ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ì •ì˜í•´ì„œ í…ŒìŠ¤íŠ¸í•œë‹¤. ë§Œì¼ í…ŒìŠ¤íŠ¸í•  ëª¨ë“ˆì— ë‹¤ë¥¸ ëª¨ë“ˆì´ `import`ëœ ìƒíƒœë¼ë©´ í•„ìš”í•œ ëª¨ë“ˆì„ ì¶”ê°€í•´ì¤€ë‹¤. ì•ˆê·¸ëŸ¬ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. í˜¹ì‹œ ì¶”ê°€í•´ë„ ì—ëŸ¬ê°€ ë‚œë‹¤ë©´ ìˆœì„œë¥¼ ë§ì¶”ì–´ ê°™ì€ ì¸ë±ìŠ¤ ìœ„ì¹˜ì— ë“±ë¡í•œë‹¤.

### E2E Test

ì¢…ë‹¨ í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.

```typescript showLineNumbers filename="test/app.e2e-spec.ts"
import { Test, TestingModule } from "@nestjs/testing";
import { INestApplication } from "@nestjs/common";
import * as request from "supertest";
import { AppModule } from "@src/app.module";
import { DataSource } from "typeorm";
import { ApiResponseModule } from "@src/api.response/api.response.module";
import { LoggerModule } from "@src/logger/logger.module";

describe("AppController (e2e)", () => {
  let app: INestApplication;
  let dataSource: DataSource;

  beforeEach(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [ApiResponseModule, LoggerModule, AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    dataSource = moduleFixture.get<DataSource>(DataSource); /* ì¶”ê°€ëœ ì½”ë“œ */

    await app.init();
  });

  afterEach(async () => {
    await app.close();
  });

  describe("/board (GET)", () => {
    it("resonse status", () => {
      return request(app.getHttpServer())
        .get("/board")
        .expect(200)
        .timeout(3000);
    });
    it("resonse data length", () => {
      return request(app.getHttpServer())
        .get("/board")
        .expect(200)
        .expect((res) => {
          return res.body.data.length === 3;
        });
    });
  });
});
```

ì—¬ê¸°ì„œ `alias`ë¡œ ì„¤ì •í•œ ëª¨ë“ˆì´ ì œëŒ€ë¡œ `import`ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ `jest-e2e.json`ì˜ ì„¤ì •ì—ì„œ ë‹¤ìŒì„ ì¶”ê°€í•œë‹¤.

```json highlight={9-11} showLineNumbers filename="test/jest-e2e.json"
{
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": ".",
  "testEnvironment": "node",
  "testRegex": ".e2e-spec.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  },
  "moduleNameMapper": {
    "^@src/(.*)$": "<rootDir>/../src/$1"
  }
}
```

`<rootDir>`ì´ "."ì´ ì•„ë‹ˆë¼ "src"ë¼ë©´ `<rootDir>/$1`ë¡œ ì„¤ì •í•˜ë©´ ëœë‹¤.

## ë§ˆë¬´ë¦¬

ì´ë²ˆ í¬ìŠ¤íŒ…ì€ í‰ì„œì²´ë¥¼ ì‚¬ìš©í•´ì„œ í‰ì†Œ ê²½ì–´ì²´ë¥¼ ì‚¬ìš©í•˜ë˜ í¬ìŠ¤íŒ…ê³¼ ëŠë‚Œì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ ğŸ˜€

ìµœê·¼ êµ¬ì§ í™œë™ ì¤‘ì— ë„¤ìŠ¤íŠ¸ì˜ ìˆ˜ìš”ê°€ ë§ì•„ì§€ëŠ” ê²ƒì„ ê³ ë ¤í•´ì„œ ë¦¬ë”©í–ˆë˜ ë‚´ìš©ê³¼ ì˜ˆì‹œë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. ì‚½ì§ˆí–ˆë˜ ë‚´ìš©ì„ ë‹´ê¸°ì—” ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ì–´ì§ˆ ê²ƒ ê°™ì•„ ëŒ€ë¶€ë¶„ì˜ í•´ê²° ë°©ë²•ì„ ì•„ë˜ ë§í¬ì— ìœ„ì„í–ˆìŠµë‹ˆë‹¤.

ë„¤ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì˜ì¡´ì„± ì£¼ì…ì´ë©°, ì œì–´ì˜ ì—­ì „ê³¼ ê°™ì€ ê°œë… ë“± ìŠ¤í”„ë§ë¶€íŠ¸ì™€ ë§ì€ ìœ ì‚¬ì ì´ ìˆì–´ì„œ ìƒê°ì´ ë‚¬ìŠµë‹ˆë‹¤. ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì‚¬ìš©í–ˆë˜ ê²½í—˜ ë•ë¶„ì— ë„¤ìŠ¤íŠ¸ë¥¼ ìµíˆëŠ”ë° ë§ì€ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë‚˜ì•„ê°€ ì´ë²ˆ ê³µë¶€ë¥¼ ë°œíŒì‚¼ì•„ CQRSì™€ í†µí•© ì¸ì¦ì„ ìœ„í•œ passport, ìŠ¤ì›¨ê±°ë¥¼ ì‚¬ìš©í•œ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì¶•í•˜ëŠ” ë‚´ìš©ìœ¼ë¡œ í¬ìŠ¤íŒ…í•˜ë ¤í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ ê¸°ìˆ ì„ ìµí ë•Œë§ˆë‹¤ ê³µë¶€í•´ì•¼í•  ë¶€ë¶„ì´ ì¡°ê¸ˆì”© ë³´ì´ë‹ˆ ì¼ì„ì´ì¡°ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ğŸ˜

ì—¬ê¸°ê¹Œì§€ ë´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ™‡â€â™‚ï¸

---

ğŸ“š í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ë‚´ìš©

[Bruno Koga - mocking test vs real database testì°¸ì¡°](https://medium.com/@bhkfazano/testing-your-api-services-with-nestjs-mocking-vs-real-database-bbfe689ed745)

[Nest.js::router global prefix ì„¤ì • ì°¸ì¡°](https://docs.nestjs.com/faq/global-prefix)

[jakekwakë‹˜ GitBook::HTTP module](https://jakekwak.gitbook.io/nestjs/techniques/http-module)

[Nest.js AuthGuard ì„¤ì • ì—ëŸ¬::ExceptionHandler metatype is not a constructor](https://velog.io/@wanzekim/ERROR-ExceptionHandler-metatype-is-not-a-constructor)

[Nest.js::Guards](https://docs.nestjs.com/guards)

[Nest.js::configuration ì„¤ì • ì°¸ì¡° - 1](https://www.daleseo.com/nestjs-configuration/)

[Nest.js::Docs JWT ì„¤ì • ì°¸ì¡° - 1](https://docs.nestjs.com/security/authentication#jwt-token)

[Nest.js::JWT ì„¤ì • ì°¸ì¡° - 1::(ë™ì‹œì„± ë¬¸ì œ) secretOrPrivateKey must have a value](https://velog.io/@daep93/Nestjs-secretOrPrivateKey-must-have-a-value)

[Nest.js::transaction ì„¤ì • ì°¸ì¡° - 1](https://cherrypick.co.kr/typeorm-basic-transaction/)

[Nest.js ìƒì„± ì‹œ cascade ì„¤ì • ì°¸ì¡°](https://stackoverflow.com/questions/65012414/issue-saving-entity-through-cascade-with-one-to-many-relationship)

[stackoverflow::database useFactory ì˜ˆì‹œ ì°¸ì¡° - 1](https://stackoverflow.com/questions/67166620/how-to-get-values-from-custom-configuration-file-in-nestjs-with-interface/67181920#67181920)

[í¬ì‹œë‹˜ ë¸”ë¡œê·¸::[Nest.js] 6. TypeORM ì„¤ì¹˜ ë° ì„¸íŒ… - @nestjs/config ì‚¬ìš©ë²•](https://4sii.tistory.com/417)

[Nest.js::E2E ì¢…ë‹¨ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ ì°¸ì¡°](https://medium.com/@salmon.3e/integration-testing-with-nestjs-and-typeorm-2ac3f77e7628)

[Nest.js::TypeOrm getConnection ë²„ì „ ì—…ë°ì´íŠ¸ì— ë”°ë¥¸ deprecated ëŒ€ì²´ ë°©ë²• ì°¸ì¡°](https://jhyeok.com/typeorm-0.3/)

[1youngsë‹˜ ë¸”ë¡œê·¸::ìœ ë‹›, ì¢…ë‹¨ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ ì°¸ì¡°](https://velog.io/@1yongs_/NestJS-Testing-Jest)

[í‘¸ë¥´ê³ ë‹˜ ë¸”ë¡œê·¸::[NestJS] e2eí…ŒìŠ¤íŠ¸ Jest í…ŒìŠ¤íŠ¸ ì‹œ DB ì´ˆê¸°í™”í•˜ëŠ” ë²•](https://puleugo.tistory.com/114)

[ì°¨ê°€ìš´ì—ìŠ¤í”„ë ˆì†Œë‹˜ ë¸”ë¡œê·¸::Carryduo | Jestë¥¼ ì´ìš©í•œ Unit/E2E í…ŒìŠ¤íŠ¸ (NestJS)](https://coldpresso.tistory.com/13)

[Devklyë‹˜ ë¸”ë¡œê·¸::ê°„ë‹¨í•œ APIë¥¼ TDDë¡œ ë§Œë“¤ì–´ë³´ê¸° (with Nest.js)](https://devkly.com/nodejs/simple-tdd-with-nestjs/)

[Parkjuidaë‹˜ ë¸”ë¡œê·¸::Nest.js ì˜ ìœ ë‹› í…ŒìŠ¤íŠ¸(Unit test)](https://dailybook-with.tistory.com/entry/Nestjs-%EC%9D%98-%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8Unit-test)

[dzone::TDD ê´€ë ¨ ê¸°ì‚¬ ì°¸ì¡°](https://dzone.com/articles/tdd-typescript-nestjs-api-layers-with-jest-part1-controller)

[jujube0ë‹˜ ë¸”ë¡œê·¸::NestJSë¡œ REST API ë§Œë“¤ê¸°](https://velog.io/@jujube0/NestJS%EB%A1%9C-REST-API-%EB%A7%8C%EB%93%A4%EA%B8%B0#introducing-the-config-module)

[ì½”ë“œê¸°ì–´ë‹˜ ë¸”ë¡œê·¸::NestJS - 18. ì„¤ì • íŒŒì¼ & í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬](https://codegear.tistory.com/82)
