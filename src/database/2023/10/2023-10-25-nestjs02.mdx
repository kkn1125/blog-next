---
slug: "/nestjs02/"
date: 2023-10-25 17:37:25 +0000
modified: 2023-10-25 17:37:25 +0000
title: "[NESTJS] Swaggerì™€ Decorator, Pipe, Guard ì•Œì•„ë³´ê¸°"
author: Kimson
categories: [nestjs]
image: /assets/images/post/covers/TIL-nest2.png
tags: [node, nest, framework, swagger, decorator, pipe, role, guard, til]
description: "ë¬¸ì„œí™”ì™€ ë¯¸ë“¤ì›¨ì–´

ë¬¸ì„œí™”ëŠ” í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ë©´ì„œ ì ˆëŒ€ ë¹ ì§ˆ ìˆ˜ ì—†ëŠ” ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì„±ê²©ì´ ë‹¤ë¥¸ ë‘ ê°€ì§€ ì£¼ì œë¥¼ ë‹¤ë£¨ë ¤ê³  í•©ë‹ˆë‹¤. ë¬¸ì„œí™”ì— ì‚¬ìš©ë˜ëŠ” `Swagger(ì´í•˜ ìŠ¤ì›¨ê±°)`ë¥¼ ì„¤ì •í•˜ëŠ” ê³¼ì •ê³¼ ë¯¸ë“¤ì›¨ì–´ì˜ ì„±ê²©ì„ ê°€ì§„ `Pipe(ì´í•˜ íŒŒì´í”„)`ì™€ `Guard(ì´í•˜ ê°€ë“œ)`ëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ê³  ì–´ë””ì— ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë´…ë‹ˆë‹¤.

Swagger ì„¤ì •

ìŠ¤ì›¨ê±°ëŠ” `OpenAPI`ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ê°™ì€ ê³µê°œëœ APIì˜ ê°œë…ì´ ì•„ë‹™ë‹ˆë‹¤. `OpenAPI Specification(OpenAPI ì‚¬ì–‘)`ì€ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ APIë¥¼ ì •ì˜í•˜ê¸° ìœ„í•œ í‘œì¤€í™”ëœ ìˆ˜ë‹¨ì„ ì œê³µí•˜ëŠ” HTTP APIìš© ì‚¬ì–‘ ì–¸ì–´ì…ë‹ˆë‹¤. ì¤„ì—¬ì„œ `OAS`ë¼ê³  í•©ë‹ˆë‹¤."
featured: true
rating: 4.5
profile: false
published: true
---

# ë¬¸ì„œí™”ì™€ ë¯¸ë“¤ì›¨ì–´

ë¬¸ì„œí™”ëŠ” í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ë©´ì„œ ì ˆëŒ€ ë¹ ì§ˆ ìˆ˜ ì—†ëŠ” ìš”ì†Œ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì„±ê²©ì´ ë‹¤ë¥¸ ë‘ ê°€ì§€ ì£¼ì œë¥¼ ë‹¤ë£¨ë ¤ê³  í•©ë‹ˆë‹¤. ë¬¸ì„œí™”ì— ì‚¬ìš©ë˜ëŠ” `Swagger(ì´í•˜ ìŠ¤ì›¨ê±°)`ë¥¼ ì„¤ì •í•˜ëŠ” ê³¼ì •ê³¼ ë¯¸ë“¤ì›¨ì–´ì˜ ì„±ê²©ì„ ê°€ì§„ `Pipe(ì´í•˜ íŒŒì´í”„)`ì™€ `Guard(ì´í•˜ ê°€ë“œ)`ëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•˜ê³  ì–´ë””ì— ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë´…ë‹ˆë‹¤.

## Swagger ì„¤ì •

ìŠ¤ì›¨ê±°ëŠ” `OpenAPI`ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ê°™ì€ ê³µê°œëœ APIì˜ ê°œë…ì´ ì•„ë‹™ë‹ˆë‹¤. `OpenAPI Specification(OpenAPI ì‚¬ì–‘)`ì€ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ APIë¥¼ ì •ì˜í•˜ê¸° ìœ„í•œ í‘œì¤€í™”ëœ ìˆ˜ë‹¨ì„ ì œê³µí•˜ëŠ” HTTP APIìš© ì‚¬ì–‘ ì–¸ì–´ì…ë‹ˆë‹¤. ì¤„ì—¬ì„œ `OAS`ë¼ê³  í•©ë‹ˆë‹¤.

ì°¸ê³ ë¡œ `í¬ìŠ¤íŠ¸ë§¨(postman)` ë˜í•œ `OpenAPI` ì‚¬ì–‘ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. `nestjs(ì´í•˜ ë„¤ìŠ¤íŠ¸)`ì—ì„œ ìŠ¤ì›¨ê±°ë¥¼ ì„¤ì •í•˜ê³  [ê³µì‹ í™ˆí˜ì´ì§€](https://docs.nestjs.com/openapi/introduction)ì— ìˆëŠ” ë‚´ìš©ì„ í† ëŒ€ë¡œ ì‘ì„±í•´ë‚˜ê°€ê² ìŠµë‹ˆë‹¤.

```bash
npm i -S @nestjs/swagger
```

ë„¤ìŠ¤íŠ¸ì—ì„œ ì§€ì›í•˜ëŠ” ìŠ¤ì›¨ê±° ëª¨ë“ˆì„ ì¶”ê°€í•˜ê³  ì•„ë˜ ë¶€íŠ¸ìŠ¤íŠ¸ë© í•¨ìˆ˜ì—ì„œ ë„íë¨¼íŠ¸ ë¹Œë”ë¥¼ í†µí•´ ì¶”ê°€í•´ì¤ë‹ˆë‹¤. ì†ŒìŠ¤ì½”ë“œëŠ” [ë³¸ ë¸”ë¡œê·¸ì˜ ì´ì „ í¬ìŠ¤íŒ…::Nest.js í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •í•˜ê¸°](/blog/nestjs01/)ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.

```diff-typescript showLineNumbers filename="src/main.ts"
+import { DocumentBuilder, SwaggerModule } from "@nestjs/swagger";
import { ConfigService } from "@nestjs/config/dist";
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";
import { CustomLoggerService } from "./logger/logger.service";
import { UserService } from "./user/user.service";

async function bootstrap() {
  const app = await NestFactory.create(AppModule, {
    bufferLogs: true,
  });
  const logger = app.get(CustomLoggerService);

  app.setGlobalPrefix("api");
  app.useLogger(logger);

  const configService: ConfigService = app.get<ConfigService>(ConfigService);
  const port = configService.get("PORT", 5000);

+  /* swagger ì„¤ì • */
+  const config = new DocumentBuilder()
+    .setTitle("board domain")
+    .setDescription("The board API description")
+    .setVersion("1.0")
+    .addTag("board", "board tag")
+    .build();

+  const document = SwaggerModule.createDocument(app, config, {
+    include: [BoardModule], // íŠ¹ì • ëª¨ë“ˆë§Œ ë¬¸ì„œí™”
+  });
+  SwaggerModule.setup("docs", app, document);

  await app.listen(port);

  logger.log("server listening on port " + port);
}
bootstrap();
```

`29ë¼ì¸`ì—ì„œ `include` ì†ì„±ì„ ì„¤ì •í•˜ë©´ ì„ íƒí•œ ëª¨ë“ˆë§Œ ë¬¸ì„œí™”í•©ë‹ˆë‹¤. ê·¸ ì™¸ ëª¨ë“ˆì€ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `include`ì—†ì´ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ëœ ëª¨ë“  ëª¨ë“ˆì„ ìë™ìœ¼ë¡œ ë¬¸ì„œí™” í•©ë‹ˆë‹¤. ìƒì„±ëœ ëª¨ìŠµì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![ìŠ¤ì›¨ê±° ìƒì„± í˜ì´ì§€](https://github.com/kkn1125/kkn1125.github.io/assets/71887242/49c3f532-b21b-44e4-96d6-c80395015855)

### Schema ì„¤ì •

```diff-typescript showLineNumbers filename="src/board/board.entity.ts"
+import { ApiProperty } from "@nestjs/swagger/dist";
import { User } from "@src/user/entities/user.entity";
import {
  BaseEntity,
  Column,
  Entity,
  JoinColumn,
  JoinTable,
  ManyToOne,
  PrimaryGeneratedColumn,
} from "typeorm";
import { DeleteDateColumn } from "typeorm/decorator/columns/DeleteDateColumn";

@Entity()
export class Board extends BaseEntity {
+  @ApiProperty({ example: 1, description: "ê²Œì‹œíŒ PK" })
  @PrimaryGeneratedColumn()
  id: number;

+  @ApiProperty({ example: "í…ŒìŠ¤íŠ¸ ì œëª©", description: "ê²Œì‹œíŒ ì œëª©" })
  @Column()
  title: string;

+  @ApiProperty({ example: "í…ŒìŠ¤íŠ¸ ë‚´ìš©.....", description: "ê²Œì‹œíŒ ë‚´ìš©" })
  @Column()
  content: string;

+  @ApiProperty({ example: 1, description: "ì‘ì„±ì PK" })
  @Column()
  author: number;

+  @ApiProperty({
+    examples: ["2023-10-12", null],
+    description: "ê²Œì‹œê¸€ ì‚­ì œ ì‹œê°„",
+    required: false,
+    nullable: true,
+  })
  @DeleteDateColumn()
  deleted_at: string;

  @ManyToOne(() => User, (user) => user.boards, {
    cascade: true,
  })
  @JoinColumn({
    name: "author",
  })
  user: User;
}
```

`ApiProperty` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ìŠ¤ì›¨ê±° í˜ì´ì§€ì— ìŠ¤í‚¤ë§ˆê°€ ìƒì„±ë©ë‹ˆë‹¤.

### Schema ë“±ë¡ì´ ë˜ì§€ ì•Šì„ ë•Œ

í•˜ì§€ë§Œ `Board`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±ë˜ì§€ ì•Šê³ , ì œëŒ€ë¡œ ë“±ë¡ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆëŠ”ë° ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì„œë¹„ìŠ¤ì— `import`ë˜ì§€ ì•Šê±°ë‚˜ ì‚¬ìš©ë˜ì§€ ì•Šì•˜ì„ ë•Œ ìŠ¤ì›¨ê±°ê°€ ì°¾ì§€ ëª»í•˜ëŠ” ìƒí™©ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff-typescript showLineNumbers filename="src/board/board.controller.ts" highlight={42}
import {
  Body,
  Controller,
  Delete,
  Get,
  Param,
  Post,
  Put,
  Query,
  Request,
  UseGuards,
  ValidationPipe,
} from "@nestjs/common";
+import { ApiOkResponse, ApiOperation, ApiTags } from "@nestjs/swagger";
import { ApiResponseService } from "@src/api.response/api.response.service";
import { AuthGuard } from "@src/auth/auth.guard";
import { CustomLoggerService } from "@src/logger/logger.service";
import { UserService } from "@src/user/user.service";
import { BoardPipe } from "./board.pipe";
import { BoardService } from "./board.service";
import { CreateBoardDto } from "./dto/create-board.dto";
import { UpdateBoardDto } from "./dto/update-board.dto";
import { Board } from "./entities/board.entity";

+@ApiTags("ê²Œì‹œíŒ API")
@Controller("board")
export class BoardController {
  constructor(
    private readonly userService: UserService,
    private readonly boardService: BoardService,
    private readonly logger: CustomLoggerService
  ) {
    logger.setContext(BoardController.name);
  }

+  @ApiOperation({
+    summary: "ê²Œì‹œíŒ ì „ì²´ ì¡°íšŒ",
+    description: "ê²Œì‹œíŒ ì „ì²´ë¥¼ ì¡°íšŒí•œë‹¤.",
+  })
+  @ApiOkResponse({
+    status: "2XX",
    type: Board,
+  })
  @Get()
  findAll(@Query("page", BoardPipe) page: number) {
    this.logger.log("test page");
    this.logger.log(page);
    return page;
  }

  @Get(":id")
  findOne(@Param("id") id: string) {
    return this.boardService.findOne(+id);
  }

  @UseGuards(AuthGuard)
  @Post()
  async create(
    @Request() req,
    @Body(new ValidationPipe({ stopAtFirstError: true, groups: ["create"] }))
    createBoardDto: CreateBoardDto
  ) {
    console.log(req.user, createBoardDto);
    createBoardDto.user = await this.userService.findOne(req.user.sub);
    return this.boardService.create(createBoardDto);
  }

  @Post("restore/:id")
  resotre(@Param("id") id: string) {
    return this.boardService.restore(+id);
  }

  @Put(":id")
  update(@Param("id") id: string, @Body() updateBoardDto: UpdateBoardDto) {
    return this.boardService.update(+id, updateBoardDto);
  }

  @Delete(":id")
  remove(@Param("id") id: string) {
    return this.boardService.remove(+id);
  }
}
```

ìœ„ì²˜ëŸ¼ ì»¨íŠ¸ë¡¤ëŸ¬ì— `import`í•œ í›„ ë“±ë¡ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

## ë¯¸ë“¤ì›¨ì–´

ë¯¸ë“¤ì›¨ì–´ ì„±ê²©ì˜ ê°€ë“œì™€ íŒŒì´í”„ë¥¼ ì„¤ì •í•˜ê³  í™œìš©ë˜ëŠ” ë°©ì‹ì„ ëª‡ê°€ì§€ ê¸°ë¡í•˜ê³ ì í•©ë‹ˆë‹¤.

ê°€ë“œë¥¼ ì´ìš©í•´ ì¸ì¦ê³¼ ê¶Œí•œ ê²€ì¦ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê¼­ ì¸ì¦ê´€ë ¨í•´ì„œ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ëŒ€ê²Œ ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ê³  `JWT`ë¥¼ ì—°ê²°í•˜ë©°, í•´ë‹¹ í† í°ì˜ ê¶Œí•œì„ ê²€ì¦í•´ì„œ "ì›í•˜ëŠ” ì—­í• "ì˜ ì‚¬ìš©ìê°€ íŠ¹ì • ë©”ì„œë“œë¥¼ í†µê³¼í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### RoleDecorator

ì—¬ê¸°ì„œ "ì—­í• "ì— ëŒ€í•œ ë©”ì„œë“œ í†µê³¼ëŠ” `ë°ì½”ë ˆì´í„°`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê°€ë“œì™€ ë¬´ê´€í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í•¨ê»˜ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. ê°€ë“œ ìƒì„±ê³¼ ì„¤ì •ì— ëŒ€í•œ ë‚´ìš©ì€ [ì´ì „ í¬ìŠ¤íŒ…](/blog/nestjs01/#Authentication)ì„ ì°¸ì¡°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

ë°”ë¡œ ë°ì½”ë ˆì´í„°ë¡œ ë„˜ì–´ê°€ì„œ "ì—­í• "ì„ ê²€ì¦í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤.

```typescript showLineNumbers filename="src/role/role.decorator.ts"
import { Reflector } from "@nestjs/core";

export const Role = Reflector.createDecorator<string[]>();
```

ë°ì½”ë ˆì´í„°ëŠ” `nest cli`ë¥¼ í†µí•´ í¸í•˜ê²Œ ì„¸íŒ… ê°€ëŠ¥í•©ë‹ˆë‹¤. ìƒì„± í›„ `Reflector`ë¥¼ ì‚¬ìš©í•´ ìƒì„±í•©ë‹ˆë‹¤. ì´ ìƒíƒœì—ì„œ ê³§ ë°”ë¡œ ì›í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ë©”ì„œë“œ ë‹¨ìœ„ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### RoleGuard

ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ë°ì´í„°ë¥¼ ê°œë°œìì˜ ì…ì¥ì—ì„œ ê°€ê³µí•˜ê³  ë¡œì§ì„ í†µí•´ ê¸°ëŠ¥ì„ ë§Œë“œëŠ” ì‘ì—…ì€ ê°€ë“œë¥¼ ìƒì„±í•´ì„œ ë³„ë„ ì‘ì—…ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

```typescript showLineNumbers filename="src/role/role.guard.ts"
import {
  CanActivate,
  ExecutionContext,
  Injectable,
  UnauthorizedException,
} from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { Reflector } from "@nestjs/core";
import { JwtService } from "@nestjs/jwt";
import { Role } from "./role.decorator";
import { Request } from "express";

@Injectable()
export class RoleGuard implements CanActivate {
  constructor(
    private readonly reflector?: Reflector,
    private readonly jwtService?: JwtService,
    private readonly configService?: ConfigService
  ) {}

  async canActivate(context: ExecutionContext): Promise<boolean> {
    const roles = this.reflector.get(Role, context.getHandler());
    if (!roles) {
      return true;
    }
    const request = context.switchToHttp().getRequest();
    const token = this.extractTokenFromHeader(request);
    console.log(token);
    if (!token) {
      throw new UnauthorizedException();
    }
    try {
      const payload = await this.jwtService.verifyAsync(token, {
        secret: this.configService.get("jwt.secret"),
      });
      // ğŸ’¡ We're assigning the payload to the request object here
      // so that we can access it in our route handlers
      request["user"] = payload;
    } catch {
      throw new UnauthorizedException();
    }

    const user = request.user || {};
    // console.log('user', user);
    return roles.includes(user.role);
  }

  private extractTokenFromHeader(request: Request): string | undefined {
    const [type, token] = request.headers.authorization?.split(" ") ?? [];
    return type === "Bearer" ? token : undefined;
  }
}
```

`request`ì— `user`í”„ë¡œí¼í‹°ë¥¼ ë„£ëŠ” ê³¼ì •ì€ `AuthGuard`ì˜ ë‚´ìš©ì„ ì¡°ê¸ˆ ëœ¯ì–´ ë¶™ì˜€ìŠµë‹ˆë‹¤.

### RoleDecorator ì‚¬ìš© ì‹œ ì£¼ì˜ì 

`RoleGuard`ì—ì„œ `Role`ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•œ ë©”ì„œë“œì— ì ‘ê·¼í•˜ëŠ” ì‚¬ìš©ìì˜ í† í°ì„ íŒŒì‹±í•˜ê³  ë©”ì„œë“œì— ì§€ì •í•œ `Role`ë²”ìœ„ì— ì†í•œë‹¤ë©´ í†µê³¼í•˜ê³  ì†í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì— ì ìš©í•œ ì˜ˆì‹œ ëª¨ìŠµì…ë‹ˆë‹¤.

```diff-typescript showLineNumbers filename="src/board/board.controller.ts" highlight={6}
// ... others
+import { Role } from "@src/role/role.decorator";
+import { RoleGuard } from "@src/role/role.guard";

@ApiTags("ê²Œì‹œíŒ API")
@UseGuards(RoleGuard) // ì¤‘ìš”í•œ ë¶€ë¶„
@Controller("board")
export class BoardController {
  constructor(
    private readonly userService: UserService,
    private readonly boardService: BoardService,
    private readonly logger: CustomLoggerService
  ) {
    logger.setContext(BoardController.name);
  }

  @ApiOperation({
    summary: "ê²Œì‹œíŒ ì „ì²´ ì¡°íšŒ",
    description: "ê²Œì‹œíŒ ì „ì²´ë¥¼ ì¡°íšŒí•œë‹¤.",
  })
  @ApiOkResponse({
    status: "2XX",
    type: Board,
  })
  @Get()
+  @Role(["user", "admin"])
  findAll(@Query("page", BoardPipe) page: number) {
    // const boards = this.boardService.findAll({
    //   page,
    // });
    this.logger.log("test page");
    this.logger.log(page);
    return page;
  }

  // ... others
}
```

ì—¬ê¸°ê¹Œì§€ëŠ” ê³µì‹ í™ˆí˜ì´ì§€ ì˜ˆì‹œ ì…ë‹ˆë‹¤. ì˜ˆì‹œì—ëŠ” ì „ì²´ ì½”ë“œê°€ ì•„ë‹Œ ë¶€ë¶„ ì½”ë“œë¡œ ì„¤ëª…í•˜ê¸° ë•Œë¬¸ì— "ì˜¤í•´ì˜ ì†Œì§€"ê°€ ìˆë‹¤ê³  ìƒê°ë©ë‹ˆë‹¤. ë•Œë¬¸ì— ë§ë¶™ì—¬ ì´ì•¼ê¸°í•˜ìë©´, `Role`ë°ì½”ë ˆì´í„°ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ì´ ë°©ê¸ˆ ì„¤ì •í•œ `RoleGuard`ì´ê¸° ë–„ë¬¸ì— `RoleGuard`ë¥¼ `UseGuard`ë°ì½”ë ˆì´í„°ë¡œ ì ìš©í•´ì„œ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.

## Pipeë¥¼ ì´ìš©í•œ ë¡œì§ ë‹¨ìˆœí™”

ê³µì‹ í™ˆí˜ì´ì§€ì—ì„œëŠ” íŒŒì´í”„ëŠ” í•„í„°ì™€ ì—°ê´€í•´ì„œ ì„¤ëª…í•©ë‹ˆë‹¤. íŒŒì´í”„ëŠ” ìš”ì²­ ë°ì´í„°ì˜ ë³€í™˜ì´ë‚˜ ìœ íš¨ì„± ê²€ì‚¬ì— ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. ê° ê¸°ìˆ ì— ëŒ€í•œ ì°¨ì´ì™€ í˜¸ì¶œì‹œê°„ê³¼ ë²”ìœ„ëŠ” [ë§ˆë¬´ë¦¬](#ë§ˆë¬´ë¦¬)ì—ì„œ ì •ë¦¬í•˜ì˜€ìœ¼ë‹ˆ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

íŒŒì´í”„ëŠ” ì•ì„œ ë°ì´í„° ë³€í™˜ì´ì•¼ê¸°ë¥¼ í–ˆìŠµë‹ˆë‹¤. ì¦‰, ìš”ì²­ ì‹œ ë„˜ì–´ì˜¤ëŠ” ê°’ì— ëŒ€í•´ì„œ ë³€í™˜í•˜ê³  í•´ë‹¹ ê°’ì— ëŒ€ì… ê°€ëŠ¥í•˜ë‹¤ëŠ” ì´ì•¼ê¸°ì…ë‹ˆë‹¤.

íŒŒì´í”„ë¥¼ ì´ìš©í•˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì½”ë“œëŸ‰ì„ ëŒ€í­ ì¤„ì¼ ìˆ˜ ìˆê¸°ë„ í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” íŒŒì´í”„ë¥¼ ì´ìš©í•´ì„œ ì „ì²´ ì¡°íšŒ ë°ì´í„°ë¡œ ë³€í™˜í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```typescript showLineNumbers filename="src/board/board.pipe.ts"
import { ArgumentMetadata, Injectable, PipeTransform } from "@nestjs/common";
import { BoardService } from "./board.service";

@Injectable()
export class BoardPipe implements PipeTransform {
  constructor(private readonly boardService: BoardService) {}

  async transform(value: any, metadata: ArgumentMetadata) {
    console.log("value", value, metadata);
    const boards = await this.boardService.findAll({ page: value });
    return boards;
  }
}
```

`cli`ë¡œ `pipe`ë¥¼ ìƒì„±í•˜ê³  `boardService`ë¥¼ ì£¼ì…í•˜ì—¬ `value`ë¥¼ ë°›ì•„ ì¡°íšŒí•©ë‹ˆë‹¤. í•´ë‹¹ íŒŒì´í”„ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ `findAll(@Query('page') page :number = 1)`ë©”ì„œë“œì— ì ìš©í•  ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ `value`ëŠ” `page`ê°’ìœ¼ë¡œ ê¸°ë³¸ê°’ 1ì…ë‹ˆë‹¤.

ì—¬ê¸°ì„œ `return`í•˜ëŠ” ê°’ì€ í•´ë‹¹ ë©”ì„œë“œì˜ `page`ë³€ìˆ˜ì— ë®ì–´ì”Œì–´ ì§‘ë‹ˆë‹¤. ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì½”ë“œëŸ‰ì´ ì¤„ì–´ë“œëŠ” íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤.

```diff-typescript showLineNumbers filename="src/board/board.contoller.ts"
// ... others
+import { BoardPipe } from "./board.pipe";
@ApiTags("ê²Œì‹œíŒ API")
@UseGuards(RoleGuard)
@Controller("board")
export class BoardController {
  constructor(
    private readonly userService: UserService,
    private readonly boardService: BoardService,
    private readonly logger: CustomLoggerService
  ) {
    logger.setContext(BoardController.name);
  }

  @ApiOperation({
    summary: "ê²Œì‹œíŒ ì „ì²´ ì¡°íšŒ",
    description: "ê²Œì‹œíŒ ì „ì²´ë¥¼ ì¡°íšŒí•œë‹¤.",
  })
  @ApiOkResponse({
    status: "2XX",
    type: Board,
  })
  @Get()
  @Role(["user", "admin"])
-  findAll(@Query("page") page: number) {
-    const boards = this.boardService.findAll({
-      page,
-    });
-    return boards;
-  }
+  findAll(@Query("page", BoardPipe) page: number) {
+    return page;
+  }

  // ... others
}
```

## ë§ˆë¬´ë¦¬

ì˜¤ëŠ˜ ë¦¬ë”©í•œ ë‚´ìš©ì„ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤. ë¬¸ì„œí™”ë¥¼ í•˜ëŠ”ë° ìˆì–´ì„œ ê¸°ë³¸ì ì¸ ì„¤ì •ê³¼ ê°€ë“œì™€ ë°ì½”ë ˆì´í„°ì˜ í™œìš©, íŒŒì´í”„ ì„¤ì •ìœ¼ë¡œ ë¡œì§ ê°„ì†Œí™”ì— ëŒ€í•œ ë‚´ìš©ì„ ë‹¤ë£¨ì—ˆìŠµë‹ˆë‹¤.

ë„¤ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ê´€ë ¨ ê¸°ìˆ ì„ í•˜ë‚˜ì”© ìµíˆëŠ”ë° ì¬ë¯¸ê°€ ë¶™ëŠ” ê²ƒ ê°™ì•„ ê¸°ì©ë‹ˆë‹¤. í”„ë ˆì„ì›Œí¬ë§Œì˜ ì¥ì ì´ë¼ê³  í•œë‹¤ë©´ ê°œë°œì— í¸ì˜ë¥¼ ë”í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œ ì‹œê°„ì„ ë‹¨ì¶• ì‹œí‚¤ê³  ë³´ê¸° ì‰½ê²Œ ê·œê²©í™” ëœë‹¤ëŠ” ê²ƒì´ë¼ ìƒê°í•˜ëŠ”ë°ìš”.

ë°˜ë©´ì— ì œê³µë˜ëŠ” ê¸°ìˆ ë§Œì„ ì‚¬ìš©í•œë‹¤ë©´ ì œí•œì ì¸ ìƒí™©ìœ¼ë¡œ ì¸í•´ ììœ ë„ê°€ ë–¨ì–´ì§€ê±°ë‚˜ í•´ë‹¹ ê¸°ìˆ ì´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ ì½”ë“œë¥¼ ì—´ì–´ë³´ëŠ” ìˆ˜ê³ ë¡œì›€ì´ ìƒê¸°ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

í¬ìŠ¤íŒ…ì—ì„œ ì–¸ê¸‰í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ í•´ë‹¹ ê¸°ìˆ ì˜ ì½”ë“œë¥¼ ì§ì ‘ ë“¤ì—¬ë‹¤ë³´ê³  ì–´ë–¤ ì›ë¦¬ë¡œ ì‘ë™í•˜ëŠ”ì§€ ì°¾ì•„ë³´ëŠ” ìŠµê´€ë§Œ ìˆë‹¤ë©´ í”„ë ˆì„ì›Œí¬ê°€ ì£¼ëŠ” ì œí•œì ì¸ ìƒí™©ì„ ê·¹ë³µí•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ ìƒê°í•©ë‹ˆë‹¤.

### Nest.jsì—ì„œ ì§€ì›í•˜ëŠ” ê¸°ìˆ  ì •ë¦¬

ë„¤ìŠ¤íŠ¸ì˜ ê¸°ìˆ  ì¤‘ì—ì„œ `middleware`, `filter`, `pipe`, `guard` ë° `interceptor` ì‚¬ì´ì˜ ì°¨ì´ì ì€ ì•¡ì„¸ìŠ¤ ë²”ìœ„ì™€ í˜¸ì¶œ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

|   êµ¬ë¶„   |     ì•¡ì„¸ìŠ¤ ë²”ìœ„      | í˜¸ì¶œ ì‹œì                                                                                    | ëª©ì                                         | ì˜ˆì‹œ                                              |
| :------: | :------------------: | :------------------------------------------------------------------------------------------ | :------------------------------------------ | :------------------------------------------------ |
| ë¯¸ë“¤ì›¨ì–´ |  ê¸€ë¡œë²Œ or ë¼ìš°íŠ¸ë³„  | ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì´ì „ ì‹¤í–‰                                                                     | ìš”ì²­ ì „ì²˜ë¦¬, ë¡œê¹…, ì¸ì¦ ë° ìš”ì²­ ë°ì´í„° íŒŒì‹± | ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë¡œê¹…í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´                 |
|   í•„í„°   |        ê¸€ë¡œë²Œ        | ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ë° ì˜ˆì™¸ í•„í„° ì´í›„ì— ì‹¤í–‰                                                      | ì „ì—­ì ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ ë° ì‘ë‹µ ë³€í™˜ì„ ì²˜ë¦¬    | ì˜¤ë¥˜ ì‘ë‹µì„ í˜•ì‹í™”í•˜ëŠ” ì˜ˆì™¸ í•„í„°                  |
|  íŒŒì´í”„  |       ë¼ìš°íŠ¸ë³„       | ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì´ì „ì— ì‹¤í–‰ë˜ë©° ìš”ì²­ ë°ì´í„°ì˜ ë³€í™˜ ë° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰                      | ìš”ì²­ ë°ì´í„°ì˜ ë°ì´í„° ë³€í™˜ ë° ìœ íš¨ì„± ê²€ì‚¬    | ìš”ì²­ ë³¸ë¬¸ ë°ì´í„°ë¥¼ ìœ íš¨ì„± ê²€ì‚¬í•˜ëŠ” ê²€ì¦ íŒŒì´í”„    |
|   ê°€ë“œ   |       ë¼ìš°íŠ¸ë³„       | ë¼ìš°íŠ¸ ê°€ë“œì˜ ì¡°ê±´ì— ë”°ë¼ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ì´ì „ì— ì‹¤í–‰                                         | ê¶Œí•œ ë° ì•¡ì„¸ìŠ¤ ì œì–´                         | ì‚¬ìš©ì ì¸ì¦ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ì¸ì¦ ê°€ë“œ             |
| ì¸í„°ì…‰í„° | ê¸€ë¡œë²Œ ë˜ëŠ” ë¼ìš°íŠ¸ë³„ | ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ ë° í•„í„° ì´í›„ì— ì‹¤í–‰ë˜ë©° ì‘ë‹µ ë°ì´í„°ë¥¼ ì „ì—­ì ìœ¼ë¡œ ë˜ëŠ” íŠ¹ì • ë¼ìš°íŠ¸ì— ëŒ€í•´ ì¡°ì‘ | ë¼ìš°í„° ê°€ë¡œì±„ê¸°                             | ì‘ë‹µ ë°ì´í„°ë¥¼ í˜•ì‹í™”í•˜ê³  í–¥ìƒì‹œí‚¤ëŠ” ì‘ë‹µ ì¸í„°ì…‰í„° |

ë„¤ìŠ¤íŠ¸ì—ì„œ ì´ëŸ¬í•œ ê¸°ìˆ ì€ ìš”ì²­ ì²˜ë¦¬ì˜ ë‹¤ë¥¸ ì¸¡ë©´ì„ ë‹¤ë£¨ë©°, ìš”ì²­ ì „ì²˜ë¦¬, ì˜ˆì™¸ ì²˜ë¦¬, ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬, ì•¡ì„¸ìŠ¤ ì œì–´ ë˜ëŠ” ì‘ë‹µ ì¡°ì‘ì´ í•„ìš”í•œì§€ì— ë”°ë¼ ì‚¬ìš©ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

ğŸ“š í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ë‚´ìš©

[ApiProperty Decorator ì ìš© ì˜ˆì‹œ ì°¸ì¡°](https://github.com/nestjs/nest/blob/master/sample/11-swagger/src/cats/entities/cat.entity.ts)

[Guard ì ìš© ì˜ˆì‹œ ì°¸ì¡°](https://github.com/nestjs/nest/blob/master/sample/01-cats-app/src/cats/cats.controller.ts)

[stackoverflow::What's the difference between Interceptor vs Middleware vs Filter in Nest.js?](https://stackoverflow.com/questions/54863655/whats-the-difference-between-interceptor-vs-middleware-vs-filter-in-nest-js)

[stackoverflow::Nestjs Swagger - Publishing different API docs on separate routes](https://stackoverflow.com/questions/59902490/nestjs-swagger-publishing-different-api-docs-on-separate-routes)
